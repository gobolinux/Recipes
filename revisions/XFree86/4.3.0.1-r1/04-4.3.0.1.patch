Index: xc/config/cf/X11.tmpl
diff -u xc/config/cf/X11.tmpl:1.196 xc/config/cf/X11.tmpl:1.196.2.1
--- xc/config/cf/X11.tmpl:1.196	Tue Feb 25 16:57:52 2003
+++ xc/config/cf/X11.tmpl	Thu Mar 27 06:43:07 2003
@@ -5,7 +5,7 @@
 XCOMM
 XCOMM
 XCOMM
-XCOMM $XFree86: xc/config/cf/X11.tmpl,v 1.196 2003/02/25 21:57:52 dawes Exp $
+XCOMM $XFree86: xc/config/cf/X11.tmpl,v 1.196.2.1 2003/03/27 11:43:07 alanh Exp $
 
 /***************************************************************************
  *                                                                         *
@@ -2181,14 +2181,14 @@
 #define GLwUseXmStubs		NO	/* create stub (weak) Motif symbols */
 #endif
 #else
-#undef  SharedLibGlw
-#define SharedLibGlw		NO
-#undef  NormalLibGlw
-#define NormalLibGlw		NO
-#undef  DebugLibGlw
-#define DebugLibGlw		NO
-#undef  ProfileLibGlw
-#define ProfileLibGlw		NO
+#undef  SharedLibGLw
+#define SharedLibGLw		NO
+#undef  NormalLibGLw
+#define NormalLibGLw		NO
+#undef  DebugLibGLw
+#define DebugLibGLw		NO
+#undef  ProfileLibGLw
+#define ProfileLibGLw		NO
 #endif
 
 #ifndef SharedLibXext
Index: xc/config/cf/linux.cf
diff -u xc/config/cf/linux.cf:3.201 xc/config/cf/linux.cf:3.201.2.1
--- xc/config/cf/linux.cf:3.201	Mon Feb 17 12:07:32 2003
+++ xc/config/cf/linux.cf	Wed Mar 12 23:10:40 2003
@@ -4,7 +4,7 @@
 
 
 
-XCOMM platform:  $XFree86: xc/config/cf/linux.cf,v 3.201 2003/02/17 17:07:32 dawes Exp $
+XCOMM platform:  $XFree86: xc/config/cf/linux.cf,v 3.201.2.1 2003/03/13 04:10:40 tsi Exp $
 
 #ifndef LinuxElfDefault
 # define LinuxElfDefault	YES
@@ -418,13 +418,6 @@
 #  else
 #    define Has3DNowSupport		NO
 #  endif
-#endif
-
-/*
- * libGLU doesn't build correctly on a libc5 system.
- */
-#if !defined(BuildGLULibrary) && (LinuxCLibMajorVersion < 6)
-# define BuildGLULibrary		NO
 #endif
 
 /*
Index: xc/config/cf/xfree86.cf
diff -u xc/config/cf/xfree86.cf:3.439 xc/config/cf/xfree86.cf:3.439.2.2
--- xc/config/cf/xfree86.cf:3.439	Wed Feb 26 15:07:59 2003
+++ xc/config/cf/xfree86.cf	Wed Apr 23 15:55:19 2003
@@ -1,4 +1,4 @@
-XCOMM $XFree86: xc/config/cf/xfree86.cf,v 3.439 2003/02/26 20:07:59 dawes Exp $
+XCOMM $XFree86: xc/config/cf/xfree86.cf,v 3.439.2.2 2003/04/23 19:55:19 herrb Exp $
 /*
  * This configuration file contains all of the configuration
  * information for the XFree86 based X Servers.
@@ -54,7 +54,7 @@
     defined(XF86_VERSION_MAJOR) && defined(XF86_VERSION_MINOR) && \
     defined(XF86_VERSION_PATCH) && defined(XF86_VERSION_SNAP)
 # if XF86_VERSION_SNAP == 0
-#define XFree86ManVersionString `echo XF86_VERSION_MAJOR XF86_VERSION_MINOR XF86_VERSION_PATCH | sed -e 's/ /./g' -e 's/^/Version /'`
+#define XFree86ManVersionString `echo XF86_VERSION_MAJOR XF86_VERSION_MINOR XF86_VERSION_PATCH | sed -e 's/ /./g' -e 's/^/Version\\\ /'`
 #else
 #define XFree86ManVersionString `echo XF86_VERSION_MAJOR XF86_VERSION_MINOR XF86_VERSION_PATCH XF86_VERSION_SNAP | sed -e 's/ /./g' -e 's/^/Version\\\ /'`
 # endif
@@ -2001,15 +2001,6 @@
 # else
 #  define Egcs112Bug NO
 # endif
-#endif
-
-/*
- * Some Linux distributions (like RH 7.0) use glibc 2.1-style setjmp,
- * but have the glibc version set to 2.2.  This can be set it host.def
- * to handle these cases.
- */
-#ifndef HasGlibc21Sigsetjmp
-#define HasGlibc21Sigsetjmp NO
 #endif
 
 #ifdef i386Architecture
Index: xc/extras/freetype2/src/base/ftmac.c
diff -u xc/extras/freetype2/src/base/ftmac.c:1.2 xc/extras/freetype2/src/base/ftmac.c:1.2.2.1
--- xc/extras/freetype2/src/base/ftmac.c:1.2	Wed Jan  1 17:08:40 2003
+++ xc/extras/freetype2/src/base/ftmac.c	Wed May  7 19:22:37 2003
@@ -545,11 +545,6 @@
     error = FT_Open_Face( library, &args, face_index, aface );
     if ( error == FT_Err_Ok )
       (*aface)->face_flags &= ~FT_FACE_FLAG_EXTERNAL_STREAM;
-    else
-    {
-      FT_Stream_CloseFunc( stream );
-      FT_FREE( stream );
-    }
 
     return error;
   }
Index: xc/extras/ogl-sample/main/gfx/lib/glu/libnurbs/internals/mysetjmp.h
diff -u xc/extras/ogl-sample/main/gfx/lib/glu/libnurbs/internals/mysetjmp.h:1.1.1.1 xc/extras/ogl-sample/main/gfx/lib/glu/libnurbs/internals/mysetjmp.h:1.1.1.1.8.1
--- xc/extras/ogl-sample/main/gfx/lib/glu/libnurbs/internals/mysetjmp.h:1.1.1.1	Mon Jan 15 16:48:33 2001
+++ xc/extras/ogl-sample/main/gfx/lib/glu/libnurbs/internals/mysetjmp.h	Wed Mar 12 23:10:41 2003
@@ -31,6 +31,7 @@
 ** published by SGI, but has not been independently verified as being
 ** compliant with the OpenGL(R) version 1.2.1 Specification.
 */
+/* $XFree86: xc/extras/ogl-sample/main/gfx/lib/glu/libnurbs/internals/mysetjmp.h,v 1.1.1.1.8.1 2003/03/13 04:10:41 tsi Exp $ */
 
 /*
  * mysetjmp.h
@@ -59,9 +60,30 @@
 #include <setjmp.h>
 #include <stdlib.h>
 
+/* Fix up for libc5 Linux systems */
+#ifndef LIBC5BUILD
+#if defined(setjmp) && defined(__GNU_LIBRARY__) && \
+    (!defined(__GLIBC__) || (__GLIBC__ < 2))
+#define LIBC5BUILD 1
+#else
+#if !LIBC5BUILD
+#undef LIBC5BUILD
+#endif
+#endif
+#endif
+
+#ifndef LIBC5BUILD
 struct JumpBuffer {
     jmp_buf	buf;
 };
+#else
+struct JumpBuffer {
+    union {
+	jmp_buf		jbuf;
+	sigjmp_buf	sbuf;
+    } buf;
+};
+#endif
 
 inline JumpBuffer *
 newJumpbuffer( void )
@@ -78,13 +100,22 @@
 inline void
 mylongjmp( JumpBuffer *j, int code ) 
 {
-    ::longjmp( j->buf, code );
+#ifndef LIBC5BUILD
+    longjmp( j->buf, code );
+#else
+    longjmp( j->buf.jbuf, code);
+#endif
 }
 
 inline int
 mysetjmp( JumpBuffer *j )
 {
-    return ::setjmp( j->buf );
+#ifndef LIBC5BUILD
+    return setjmp( j->buf );
+#else
+    __sigjmp_save( j->buf.sbuf, 1);
+    return __setjmp( j->buf.sbuf->__jmpbuf );
+#endif
 }
 #endif
 
Index: xc/lib/GL/mesa/src/drv/i830/i830_tex.c
diff -u xc/lib/GL/mesa/src/drv/i830/i830_tex.c:1.4 xc/lib/GL/mesa/src/drv/i830/i830_tex.c:1.4.2.1
--- xc/lib/GL/mesa/src/drv/i830/i830_tex.c:1.4	Mon Dec  9 20:26:53 2002
+++ xc/lib/GL/mesa/src/drv/i830/i830_tex.c	Wed May  7 17:59:42 2003
@@ -25,7 +25,7 @@
 
 **************************************************************************/
 
-/* $XFree86: xc/lib/GL/mesa/src/drv/i830/i830_tex.c,v 1.4 2002/12/10 01:26:53 dawes Exp $ */
+/* $XFree86: xc/lib/GL/mesa/src/drv/i830/i830_tex.c,v 1.4.2.1 2003/05/07 21:59:42 dawes Exp $ */
 
 /*
  * Author:
@@ -287,7 +287,12 @@
    case GL_TEXTURE_LOD_BIAS_EXT:
       {
          struct gl_texture_object *tObj = ctx->Texture.Unit[unit]._Current;
-         i830TextureObjectPtr t = (i830TextureObjectPtr) tObj->DriverData;
+         i830TextureObjectPtr t;
+	 if (!tObj) return;
+
+	 t = (i830TextureObjectPtr) tObj->DriverData;
+	 if (!t) return;
+
 	 i830ComputeLodBias(imesa, t, *param);
 	 /* Do a state change */
 	 if (t == imesa->CurrentTexObj[unit]) {
Index: xc/lib/GL/mesa/src/drv/r200/r200_context.c
diff -u xc/lib/GL/mesa/src/drv/r200/r200_context.c:1.2 xc/lib/GL/mesa/src/drv/r200/r200_context.c:1.2.2.1
--- xc/lib/GL/mesa/src/drv/r200/r200_context.c:1.2	Mon Dec 16 11:18:53 2002
+++ xc/lib/GL/mesa/src/drv/r200/r200_context.c	Tue May  6 19:21:44 2003
@@ -1,4 +1,4 @@
-/* $XFree86: xc/lib/GL/mesa/src/drv/r200/r200_context.c,v 1.2 2002/12/16 16:18:53 dawes Exp $ */
+/* $XFree86: xc/lib/GL/mesa/src/drv/r200/r200_context.c,v 1.2.2.1 2003/05/06 23:21:44 daenzer Exp $ */
 /*
 Copyright (C) The Weather Channel, Inc.  2002.  All Rights Reserved.
 
@@ -391,6 +391,7 @@
     */
    _tnl_destroy_pipeline( ctx );
    _tnl_install_pipeline( ctx, r200_pipeline );
+   ctx->Driver.FlushVertices = r200FlushVertices;
 
    /* Try and keep materials and vertices separate:
     */
Index: xc/lib/GL/mesa/src/drv/r200/r200_swtcl.c
diff -u xc/lib/GL/mesa/src/drv/r200/r200_swtcl.c:1.3 xc/lib/GL/mesa/src/drv/r200/r200_swtcl.c:1.3.2.1
--- xc/lib/GL/mesa/src/drv/r200/r200_swtcl.c:1.3	Mon Dec 23 10:29:26 2002
+++ xc/lib/GL/mesa/src/drv/r200/r200_swtcl.c	Tue May  6 19:21:44 2003
@@ -1,4 +1,4 @@
-/* $XFree86: xc/lib/GL/mesa/src/drv/r200/r200_swtcl.c,v 1.3 2002/12/23 15:29:26 tsi Exp $ */
+/* $XFree86: xc/lib/GL/mesa/src/drv/r200/r200_swtcl.c,v 1.3.2.1 2003/05/06 23:21:44 daenzer Exp $ */
 /*
 Copyright (C) The Weather Channel, Inc.  2002.  All Rights Reserved.
 
@@ -46,6 +46,7 @@
 #include "math/m_translate.h"
 #include "tnl/tnl.h"
 #include "tnl/t_context.h"
+#include "tnl/t_imm_exec.h"
 #include "tnl/t_pipeline.h"
 
 #include "r200_context.h"
@@ -1222,6 +1223,14 @@
       r200ChooseVertexState( ctx );
 }
 
+
+void r200FlushVertices( GLcontext *ctx, GLuint flags )
+{
+   _tnl_flush_vertices( ctx, flags );
+
+   if (flags & FLUSH_STORED_VERTICES) 
+      R200_FIREVERTICES( R200_CONTEXT( ctx ) );
+}
 
 /**********************************************************************/
 /*                            Initialization.                         */
Index: xc/lib/GL/mesa/src/drv/r200/r200_swtcl.h
diff -u xc/lib/GL/mesa/src/drv/r200/r200_swtcl.h:1.2 xc/lib/GL/mesa/src/drv/r200/r200_swtcl.h:1.2.2.1
--- xc/lib/GL/mesa/src/drv/r200/r200_swtcl.h:1.2	Mon Dec 16 11:18:55 2002
+++ xc/lib/GL/mesa/src/drv/r200/r200_swtcl.h	Tue May  6 19:21:45 2003
@@ -1,4 +1,4 @@
-/* $XFree86: xc/lib/GL/mesa/src/drv/r200/r200_swtcl.h,v 1.2 2002/12/16 16:18:55 dawes Exp $ */
+/* $XFree86: xc/lib/GL/mesa/src/drv/r200/r200_swtcl.h,v 1.2.2.1 2003/05/06 23:21:45 daenzer Exp $ */
 /*
 Copyright (C) The Weather Channel, Inc.  2002.  All Rights Reserved.
 
@@ -42,6 +42,7 @@
 extern void r200InitSwtcl( GLcontext *ctx );
 extern void r200DestroySwtcl( GLcontext *ctx );
 
+extern void r200FlushVertices( GLcontext *ctx, GLuint flags );
 extern void r200ChooseRenderState( GLcontext *ctx );
 extern void r200ChooseVertexState( GLcontext *ctx );
 
Index: xc/lib/GL/mesa/src/drv/r200/r200_vtxfmt.c
diff -u xc/lib/GL/mesa/src/drv/r200/r200_vtxfmt.c:1.3 xc/lib/GL/mesa/src/drv/r200/r200_vtxfmt.c:1.3.2.1
--- xc/lib/GL/mesa/src/drv/r200/r200_vtxfmt.c:1.3	Mon Dec 16 11:18:55 2002
+++ xc/lib/GL/mesa/src/drv/r200/r200_vtxfmt.c	Tue May  6 19:21:45 2003
@@ -1,4 +1,4 @@
-/* $XFree86: xc/lib/GL/mesa/src/drv/r200/r200_vtxfmt.c,v 1.3 2002/12/16 16:18:55 dawes Exp $ */
+/* $XFree86: xc/lib/GL/mesa/src/drv/r200/r200_vtxfmt.c,v 1.3.2.1 2003/05/06 23:21:45 daenzer Exp $ */
 /*
 Copyright (C) The Weather Channel, Inc.  2002.  All Rights Reserved.
 
@@ -38,6 +38,7 @@
 #include "r200_ioctl.h"
 #include "r200_tex.h"
 #include "r200_tcl.h"
+#include "r200_swtcl.h"
 #include "r200_vtxfmt.h"
 
 #include "api_noop.h"
@@ -59,7 +60,7 @@
 
 struct r200_vb vb;
 
-static void r200FlushVertices( GLcontext *, GLuint );
+static void r200VtxFmtFlushVertices( GLcontext *, GLuint );
 
 static void count_func( const char *name,  struct dynfn *l )
 {
@@ -357,12 +358,13 @@
       fprintf(stderr, "%s from %s\n", __FUNCTION__, caller);
 
    if (ctx->Driver.NeedFlush) 
-      r200FlushVertices( ctx, ctx->Driver.NeedFlush );
+      r200VtxFmtFlushVertices( ctx, ctx->Driver.NeedFlush );
 
    if (ctx->NewState)
       _mesa_update_state( ctx ); /* clear state so fell_back sticks */
 
    _tnl_wakeup_exec( ctx );
+   ctx->Driver.FlushVertices = r200FlushVertices;
 
    assert( rmesa->dma.flush == 0 );
    rmesa->vb.fell_back = GL_TRUE;
@@ -404,6 +406,7 @@
    prim = rmesa->vb.prim[0];
    ctx->Driver.CurrentExecPrimitive = GL_POLYGON+1;
    _tnl_wakeup_exec( ctx );
+   ctx->Driver.FlushVertices = r200FlushVertices;
 
    assert(rmesa->dma.flush == 0);
    rmesa->vb.fell_back = GL_TRUE;
@@ -756,7 +759,7 @@
 	    fprintf(stderr, "reinstall (new install)\n");
 
 	 _mesa_install_exec_vtxfmt( ctx, &rmesa->vb.vtxfmt );
-	 ctx->Driver.FlushVertices = r200FlushVertices;
+	 ctx->Driver.FlushVertices = r200VtxFmtFlushVertices;
 	 ctx->Driver.NewList = r200NewList;
 	 rmesa->vb.installed = GL_TRUE;
 	 vb.context = ctx;
@@ -772,6 +775,7 @@
 	 if (rmesa->dma.flush)
 	    rmesa->dma.flush( rmesa );
 	 _tnl_wakeup_exec( ctx );
+	 ctx->Driver.FlushVertices = r200FlushVertices;
 	 rmesa->vb.installed = GL_FALSE;
 	 vb.context = 0;
       }
@@ -931,7 +935,7 @@
    return GL_TRUE;
 }
 
-static void r200FlushVertices( GLcontext *ctx, GLuint flags )
+static void r200VtxFmtFlushVertices( GLcontext *ctx, GLuint flags )
 {
    r200ContextPtr rmesa = R200_CONTEXT( ctx );
 
Index: xc/lib/GL/mesa/src/drv/radeon/radeon_context.c
diff -u xc/lib/GL/mesa/src/drv/radeon/radeon_context.c:1.7 xc/lib/GL/mesa/src/drv/radeon/radeon_context.c:1.7.2.1
--- xc/lib/GL/mesa/src/drv/radeon/radeon_context.c:1.7	Sat Feb  8 16:26:45 2003
+++ xc/lib/GL/mesa/src/drv/radeon/radeon_context.c	Tue May  6 19:21:44 2003
@@ -1,4 +1,4 @@
-/* $XFree86: xc/lib/GL/mesa/src/drv/radeon/radeon_context.c,v 1.7 2003/02/08 21:26:45 dawes Exp $ */
+/* $XFree86: xc/lib/GL/mesa/src/drv/radeon/radeon_context.c,v 1.7.2.1 2003/05/06 23:21:44 daenzer Exp $ */
 /**************************************************************************
 
 Copyright 2000, 2001 ATI Technologies Inc., Ontario, Canada, and
@@ -382,6 +382,7 @@
     */
    _tnl_destroy_pipeline( ctx );
    _tnl_install_pipeline( ctx, radeon_pipeline );
+   ctx->Driver.FlushVertices = radeonFlushVertices;
 
    /* Try and keep materials and vertices separate:
     */
Index: xc/lib/GL/mesa/src/drv/radeon/radeon_swtcl.c
diff -u xc/lib/GL/mesa/src/drv/radeon/radeon_swtcl.c:1.4 xc/lib/GL/mesa/src/drv/radeon/radeon_swtcl.c:1.4.2.1
--- xc/lib/GL/mesa/src/drv/radeon/radeon_swtcl.c:1.4	Sat Feb 15 17:18:48 2003
+++ xc/lib/GL/mesa/src/drv/radeon/radeon_swtcl.c	Tue May  6 19:21:44 2003
@@ -1,4 +1,4 @@
-/* $XFree86: xc/lib/GL/mesa/src/drv/radeon/radeon_swtcl.c,v 1.4 2003/02/15 22:18:48 dawes Exp $ */
+/* $XFree86: xc/lib/GL/mesa/src/drv/radeon/radeon_swtcl.c,v 1.4.2.1 2003/05/06 23:21:44 daenzer Exp $ */
 /**************************************************************************
 
 Copyright 2000, 2001 ATI Technologies Inc., Ontario, Canada, and
@@ -45,6 +45,7 @@
 #include "math/m_translate.h"
 #include "tnl/tnl.h"
 #include "tnl/t_context.h"
+#include "tnl/t_imm_exec.h"
 #include "tnl/t_pipeline.h"
 
 #include "radeon_context.h"
@@ -1133,6 +1134,14 @@
    }
 }
 
+
+void radeonFlushVertices( GLcontext *ctx, GLuint flags )
+{
+   _tnl_flush_vertices( ctx, flags );
+
+   if (flags & FLUSH_STORED_VERTICES) 
+      RADEON_FIREVERTICES( RADEON_CONTEXT( ctx ) );
+}
 
 /**********************************************************************/
 /*                            Initialization.                         */
Index: xc/lib/GL/mesa/src/drv/radeon/radeon_swtcl.h
diff -u xc/lib/GL/mesa/src/drv/radeon/radeon_swtcl.h:1.1 xc/lib/GL/mesa/src/drv/radeon/radeon_swtcl.h:1.1.2.1
--- xc/lib/GL/mesa/src/drv/radeon/radeon_swtcl.h:1.1	Wed Oct 30 07:51:57 2002
+++ xc/lib/GL/mesa/src/drv/radeon/radeon_swtcl.h	Tue May  6 19:21:44 2003
@@ -1,4 +1,4 @@
-/* $XFree86: xc/lib/GL/mesa/src/drv/radeon/radeon_swtcl.h,v 1.1 2002/10/30 12:51:57 alanh Exp $ */
+/* $XFree86: xc/lib/GL/mesa/src/drv/radeon/radeon_swtcl.h,v 1.1.2.1 2003/05/06 23:21:44 daenzer Exp $ */
 /**************************************************************************
 
 Copyright 2000, 2001 ATI Technologies Inc., Ontario, Canada, and
@@ -43,6 +43,7 @@
 extern void radeonInitSwtcl( GLcontext *ctx );
 extern void radeonDestroySwtcl( GLcontext *ctx );
 
+extern void radeonFlushVertices( GLcontext *ctx, GLuint flags );
 extern void radeonChooseRenderState( GLcontext *ctx );
 extern void radeonChooseVertexState( GLcontext *ctx );
 
Index: xc/lib/GL/mesa/src/drv/radeon/radeon_vtxfmt.c
diff -u xc/lib/GL/mesa/src/drv/radeon/radeon_vtxfmt.c:1.5 xc/lib/GL/mesa/src/drv/radeon/radeon_vtxfmt.c:1.5.2.1
--- xc/lib/GL/mesa/src/drv/radeon/radeon_vtxfmt.c:1.5	Mon Dec 16 11:18:59 2002
+++ xc/lib/GL/mesa/src/drv/radeon/radeon_vtxfmt.c	Tue May  6 19:21:44 2003
@@ -1,4 +1,4 @@
-/* $XFree86: xc/lib/GL/mesa/src/drv/radeon/radeon_vtxfmt.c,v 1.5 2002/12/16 16:18:59 dawes Exp $ */
+/* $XFree86: xc/lib/GL/mesa/src/drv/radeon/radeon_vtxfmt.c,v 1.5.2.1 2003/05/06 23:21:44 daenzer Exp $ */
 /**************************************************************************
 
 Copyright 2000, 2001 ATI Technologies Inc., Ontario, Canada, and
@@ -38,6 +38,7 @@
 #include "radeon_ioctl.h"
 #include "radeon_tex.h"
 #include "radeon_tcl.h"
+#include "radeon_swtcl.h"
 #include "radeon_vtxfmt.h"
 
 #include "api_noop.h"
@@ -59,7 +60,7 @@
 
 struct radeon_vb vb;
 
-static void radeonFlushVertices( GLcontext *, GLuint );
+static void radeonVtxfmtFlushVertices( GLcontext *, GLuint );
 
 static void count_func( const char *name,  struct dynfn *l )
 {
@@ -336,12 +337,13 @@
       fprintf(stderr, "%s from %s\n", __FUNCTION__, caller);
 
    if (ctx->Driver.NeedFlush) 
-      radeonFlushVertices( ctx, ctx->Driver.NeedFlush );
+      radeonVtxfmtFlushVertices( ctx, ctx->Driver.NeedFlush );
 
    if (ctx->NewState)
       _mesa_update_state( ctx ); /* clear state so fell_back sticks */
 
    _tnl_wakeup_exec( ctx );
+   ctx->Driver.FlushVertices = radeonFlushVertices;
 
    assert( rmesa->dma.flush == 0 );
    rmesa->vb.fell_back = GL_TRUE;
@@ -382,6 +384,7 @@
    prim = rmesa->vb.prim[0];
    ctx->Driver.CurrentExecPrimitive = GL_POLYGON+1;
    _tnl_wakeup_exec( ctx );
+   ctx->Driver.FlushVertices = radeonFlushVertices;
 
    assert(rmesa->dma.flush == 0);
    rmesa->vb.fell_back = GL_TRUE;
@@ -731,7 +734,7 @@
 	    fprintf(stderr, "reinstall (new install)\n");
 
 	 _mesa_install_exec_vtxfmt( ctx, &rmesa->vb.vtxfmt );
-	 ctx->Driver.FlushVertices = radeonFlushVertices;
+	 ctx->Driver.FlushVertices = radeonVtxfmtFlushVertices;
 	 ctx->Driver.NewList = radeonNewList;
 	 rmesa->vb.installed = GL_TRUE;
 	 vb.context = ctx;
@@ -747,6 +750,7 @@
 	 if (rmesa->dma.flush)
 	    rmesa->dma.flush( rmesa );
 	 _tnl_wakeup_exec( ctx );
+	 ctx->Driver.FlushVertices = radeonFlushVertices;
 	 rmesa->vb.installed = GL_FALSE;
 	 vb.context = 0;
       }
@@ -905,7 +909,7 @@
    return GL_TRUE;
 }
 
-static void radeonFlushVertices( GLcontext *ctx, GLuint flags )
+static void radeonVtxfmtFlushVertices( GLcontext *ctx, GLuint flags )
 {
    radeonContextPtr rmesa = RADEON_CONTEXT( ctx );
 
Index: xc/lib/GLU/libnurbs/internals/Imakefile
diff -u xc/lib/GLU/libnurbs/internals/Imakefile:1.9 xc/lib/GLU/libnurbs/internals/Imakefile:1.9.2.1
--- xc/lib/GLU/libnurbs/internals/Imakefile:1.9	Fri Dec 13 23:41:12 2002
+++ xc/lib/GLU/libnurbs/internals/Imakefile	Wed Mar 12 23:10:41 2003
@@ -1,4 +1,4 @@
-XCOMM $XFree86: xc/lib/GLU/libnurbs/internals/Imakefile,v 1.9 2002/12/14 04:41:12 dawes Exp $
+XCOMM $XFree86: xc/lib/GLU/libnurbs/internals/Imakefile,v 1.9.2.1 2003/03/13 04:10:41 tsi Exp $
 
 XCOMM License Applicability. Except to the extent portions of this file are
 XCOMM made subject to an alternative license as permitted in the SGI Free
@@ -149,6 +149,8 @@
 # if OSMajorVersion <= 5
 OSDEFINES = -DNEEDCEILF
 # endif
+#elif defined(LinuxArchitecture) && (LinuxCLibMajorVersion < 6)
+OSDEFINES = -DNEEDCEILF
 #else
 OSDEFINES = -D_EXTENSIONS_
 #endif
Index: xc/lib/X11/XlcDL.c
diff -u xc/lib/X11/XlcDL.c:1.9 xc/lib/X11/XlcDL.c:1.9.2.1
--- xc/lib/X11/XlcDL.c:1.9	Mon Nov 25 09:04:53 2002
+++ xc/lib/X11/XlcDL.c	Tue Mar 11 18:18:49 2003
@@ -41,7 +41,7 @@
 Sun Microsystems, Inc. or its licensors is granted.
 
 */
-/* $XFree86: xc/lib/X11/XlcDL.c,v 1.9 2002/11/25 14:04:53 eich Exp $ */
+/* $XFree86: xc/lib/X11/XlcDL.c,v 1.9.2.1 2003/03/11 23:18:49 herrb Exp $ */
 
 #include <stdio.h>
 #if defined(hpux)
@@ -406,7 +406,7 @@
 
     if (lc_name == NULL) return (XLCd)NULL;
 
-    if (_XlcLocaleDirName(lc_dir, (char *)lc_name) == (char*)NULL)
+    if (_XlcLocaleDirName(lc_dir, BUFSIZE, (char *)lc_name) == (char*)NULL)
 	return (XLCd)NULL;
 
     resolve_object(lc_dir, lc_name);
@@ -452,7 +452,7 @@
 
   lc_name = lcd->core->name;
 
-  if (_XlcLocaleDirName(lc_dir, lc_name) == NULL) return (XIM)0;
+  if (_XlcLocaleDirName(lc_dir, BUFSIZE, lc_name) == NULL) return (XIM)0;
 
   count = lc_count;
   for (; count-- > 0; objects_list++) {
@@ -498,7 +498,7 @@
 
   lc_name = lcd->core->name;
 
-  if (_XlcLocaleDirName(lc_dir, lc_name) == NULL) return False;
+  if (_XlcLocaleDirName(lc_dir, BUFSIZE, lc_name) == NULL) return False;
 
   count = lc_count;
   for (; count-- > 0; objects_list++) {
@@ -543,7 +543,7 @@
 #endif
 
   lc_name = lcd->core->name;
-  if (_XlcLocaleDirName(lc_dir, lc_name) == NULL) return False;
+  if (_XlcLocaleDirName(lc_dir, BUFSIZE, lc_name) == NULL) return False;
 
   count = lc_count;
   for (; count-- > 0; objects_list++) {
@@ -610,7 +610,7 @@
 
   lc_name = lcd->core->name;
 
-  if (_XlcLocaleDirName(lc_dir, lc_name) == NULL) return (XOM)0;
+  if (_XlcLocaleDirName(lc_dir, BUFSIZE, lc_name) == NULL) return (XOM)0;
 
   count = lc_count;
   for (; count-- > 0; objects_list++) {
Index: xc/lib/X11/XlcPubI.h
diff -u xc/lib/X11/XlcPubI.h:3.9 xc/lib/X11/XlcPubI.h:3.9.6.1
--- xc/lib/X11/XlcPubI.h:3.9	Thu Nov 15 19:52:27 2001
+++ xc/lib/X11/XlcPubI.h	Tue Mar 11 18:18:49 2003
@@ -23,7 +23,7 @@
  * Author: Katsuhisa Yano	TOSHIBA Corp.
  *			   	mopi@osa.ilab.toshiba.co.jp
  */
-/* $XFree86: xc/lib/X11/XlcPubI.h,v 3.9 2001/11/16 00:52:27 dawes Exp $ */
+/* $XFree86: xc/lib/X11/XlcPubI.h,v 3.9.6.1 2003/03/11 23:18:49 herrb Exp $ */
 
 #ifndef _XLCPUBLICI_H_
 #define _XLCPUBLICI_H_
@@ -217,6 +217,7 @@
 extern char *_XlcLocaleDirName(
 #if NeedFunctionPrototypes
      char*             /* dir_name */,
+     size_t,	       /* dir_len */
      char*             /* lc_name */
 #endif
 );
Index: xc/lib/X11/lcFile.c
diff -u xc/lib/X11/lcFile.c:3.30 xc/lib/X11/lcFile.c:3.30.2.1
--- xc/lib/X11/lcFile.c:3.30	Mon Nov 25 09:04:53 2002
+++ xc/lib/X11/lcFile.c	Tue Mar 11 18:18:49 2003
@@ -23,7 +23,7 @@
  * SOFTWARE.
  *
 */
-/* $XFree86: xc/lib/X11/lcFile.c,v 3.30 2002/11/25 14:04:53 eich Exp $ */
+/* $XFree86: xc/lib/X11/lcFile.c,v 3.30.2.1 2003/03/11 23:18:49 herrb Exp $ */
 
 #include <stdlib.h>
 #include <stdio.h>
@@ -429,8 +429,9 @@
 }
 
 char *
-_XlcLocaleDirName(dir_name, lc_name)
+_XlcLocaleDirName(dir_name, dir_len, lc_name)
      char *dir_name;
+     size_t dir_len;
      char *lc_name;
 {
     char dir[PATH_MAX], buf[PATH_MAX], *name = NULL;
@@ -486,9 +487,16 @@
  	target_dir = args[0];
  	target_name = lc_name;
     }
-    strcpy(dir_name, target_dir);
-    strcat(dir_name, "/");
-    strcat(dir_name, target_name);
+    /* snprintf(dir_name, dir_len, "%s/%", target_dir, target_name); */
+    strncpy(dir_name, target_dir, dir_len - 1);
+    if (strlen(target_dir) >= dir_len - 1) {
+	dir_name[dir_len - 1] = '\0';
+    } else  {
+	strcat(dir_name, "/");
+	strncat(dir_name, target_name, dir_len - strlen(dir_name) - 1);
+	if (strlen(target_name) >= dir_len - strlen(dir_name) - 1) 
+	    dir_name[dir_len - 1] = '\0';
+    }
     if (target_name != lc_name)
  	Xfree(target_name);
     return dir_name;
Index: xc/programs/Xserver/hw/darwin/Imakefile
diff -u xc/programs/Xserver/hw/darwin/Imakefile:1.15 xc/programs/Xserver/hw/darwin/Imakefile:1.15.2.2
--- xc/programs/Xserver/hw/darwin/Imakefile:1.15	Fri Oct 11 20:32:43 2002
+++ xc/programs/Xserver/hw/darwin/Imakefile	Mon Mar  3 21:48:04 2003
@@ -1,4 +1,4 @@
-XCOMM $XFree86: xc/programs/Xserver/hw/darwin/Imakefile,v 1.15 2002/10/12 00:32:43 torrey Exp $
+XCOMM $XFree86: xc/programs/Xserver/hw/darwin/Imakefile,v 1.15.2.2 2003/03/04 02:48:04 torrey Exp $
 
 #include <Server.tmpl>
 #define IHaveSubdirs
@@ -19,7 +19,8 @@
 
 INCLUDES = -I. -I$(SERVERSRC)/mi -I$(SERVERSRC)/fb -I$(EXTINCSRC) \
            -I$(SERVERSRC)/render -I$(SERVERSRC)/include -I$(XINCLUDESRC) \
-           -I$(SERVERSRC)/os -I$(INCLUDESRC) -I$(FONTINCSRC)
+           -I$(SERVERSRC)/os -I$(INCLUDESRC) -I$(FONTINCSRC) \
+           -I$(SERVERSRC)/hw/xfree86
 
 OSNAME = OSName
 OSVENDOR = OSVendor
@@ -33,6 +34,10 @@
 BUILDERMSG = -DBUILDERSTRING='$(BUILDERSTRING)'
 #endif
 
+#if OSMajorVersion >= 6
+CLUTDEF = -DUSE_NEW_CLUT
+#endif
+
 #if DarwinQuartzSupport
 # if HasNSCarbonWindow
 SUBDIRS = bundle quartz utils
@@ -47,7 +52,8 @@
 DEFINES = $(QUARTZDEF)
 EXTRAMANDEFS = $(QUARTZDEF) -D__logdir__=$(LOGDIRECTORY)
 
-SpecialCObjectRule(darwin,$(ICONFIGFILES),$(OSNAMEDEF) $(BUILDERMSG) $(CUSTOMVERDEF))
+SpecialCObjectRule(darwin,$(ICONFIGFILES),$(OSNAMEDEF) $(BUILDERMSG) \
+                   $(CUSTOMVERDEF) $(CLUTDEF))
 
 NormalLibraryObjectRule()
 NormalLibraryTarget(darwin,$(OBJS))
Index: xc/programs/Xserver/hw/darwin/darwinClut8.h
diff -u xc/programs/Xserver/hw/darwin/darwinClut8.h:1.1 xc/programs/Xserver/hw/darwin/darwinClut8.h:1.1.8.1
--- xc/programs/Xserver/hw/darwin/darwinClut8.h:1.1	Thu Apr 12 16:09:53 2001
+++ xc/programs/Xserver/hw/darwin/darwinClut8.h	Mon Mar  3 20:31:43 2003
@@ -1 +1,532 @@
-/* * Darwin default 8-bit Colormap for StaticColor *//* $XFree86: xc/programs/Xserver/hw/darwin/darwinClut8.h,v 1.1 2001/04/12 20:09:53 torrey Exp $ */#ifndef _DARWIN_CLUT8_#define _DARWIN_CLUT8_ static xColorItem darwinClut8[] = {    { 0, 0x0000, 0x0000, 0x0000,  0, 0 },    { 1, 0xffff, 0xffff, 0xcccc,  0, 0 },    { 2, 0xffff, 0xffff, 0x9999,  0, 0 },    { 3, 0xffff, 0xffff, 0x6666,  0, 0 },    { 4, 0xffff, 0xffff, 0x3333,  0, 0 },    { 5, 0xffff, 0xffff, 0x0000,  0, 0 },    { 6, 0xffff, 0xcccc, 0xffff,  0, 0 },    { 7, 0xffff, 0xcccc, 0xcccc,  0, 0 },    { 8, 0xffff, 0xcccc, 0x9999,  0, 0 },    { 9, 0xffff, 0xcccc, 0x6666,  0, 0 },    { 10, 0xffff, 0xcccc, 0x3333,  0, 0 },    { 11, 0xffff, 0xcccc, 0x0000,  0, 0 },    { 12, 0xffff, 0x9999, 0xffff,  0, 0 },    { 13, 0xffff, 0x9999, 0xcccc,  0, 0 },    { 14, 0xffff, 0x9999, 0x9999,  0, 0 },    { 15, 0xffff, 0x9999, 0x6666,  0, 0 },    { 16, 0xffff, 0x9999, 0x3333,  0, 0 },    { 17, 0xffff, 0x9999, 0x0000,  0, 0 },    { 18, 0xffff, 0x6666, 0xffff,  0, 0 },    { 19, 0xffff, 0x6666, 0xcccc,  0, 0 },    { 20, 0xffff, 0x6666, 0x9999,  0, 0 },    { 21, 0xffff, 0x6666, 0x6666,  0, 0 },    { 22, 0xffff, 0x6666, 0x3333,  0, 0 },    { 23, 0xffff, 0x6666, 0x0000,  0, 0 },    { 24, 0xffff, 0x3333, 0xffff,  0, 0 },    { 25, 0xffff, 0x3333, 0xcccc,  0, 0 },    { 26, 0xffff, 0x3333, 0x9999,  0, 0 },    { 27, 0xffff, 0x3333, 0x6666,  0, 0 },    { 28, 0xffff, 0x3333, 0x3333,  0, 0 },    { 29, 0xffff, 0x3333, 0x0000,  0, 0 },    { 30, 0xffff, 0x0000, 0xffff,  0, 0 },    { 31, 0xffff, 0x0000, 0xcccc,  0, 0 },    { 32, 0xffff, 0x0000, 0x9999,  0, 0 },    { 33, 0xffff, 0x0000, 0x6666,  0, 0 },    { 34, 0xffff, 0x0000, 0x3333,  0, 0 },    { 35, 0xffff, 0x0000, 0x0000,  0, 0 },    { 36, 0xcccc, 0xffff, 0xffff,  0, 0 },    { 37, 0xcccc, 0xffff, 0xcccc,  0, 0 },    { 38, 0xcccc, 0xffff, 0x9999,  0, 0 },    { 39, 0xcccc, 0xffff, 0x6666,  0, 0 },    { 40, 0xcccc, 0xffff, 0x3333,  0, 0 },    { 41, 0xcccc, 0xffff, 0x0000,  0, 0 },    { 42, 0xcccc, 0xcccc, 0xffff,  0, 0 },    { 43, 0xcccc, 0xcccc, 0xcccc,  0, 0 },    { 44, 0xcccc, 0xcccc, 0x9999,  0, 0 },    { 45, 0xcccc, 0xcccc, 0x6666,  0, 0 },    { 46, 0xcccc, 0xcccc, 0x3333,  0, 0 },    { 47, 0xcccc, 0xcccc, 0x0000,  0, 0 },    { 48, 0xcccc, 0x9999, 0xffff,  0, 0 },    { 49, 0xcccc, 0x9999, 0xcccc,  0, 0 },    { 50, 0xcccc, 0x9999, 0x9999,  0, 0 },    { 51, 0xcccc, 0x9999, 0x6666,  0, 0 },    { 52, 0xcccc, 0x9999, 0x3333,  0, 0 },    { 53, 0xcccc, 0x9999, 0x0000,  0, 0 },    { 54, 0xcccc, 0x6666, 0xffff,  0, 0 },    { 55, 0xcccc, 0x6666, 0xcccc,  0, 0 },    { 56, 0xcccc, 0x6666, 0x9999,  0, 0 },    { 57, 0xcccc, 0x6666, 0x6666,  0, 0 },    { 58, 0xcccc, 0x6666, 0x3333,  0, 0 },    { 59, 0xcccc, 0x6666, 0x0000,  0, 0 },    { 60, 0xcccc, 0x3333, 0xffff,  0, 0 },    { 61, 0xcccc, 0x3333, 0xcccc,  0, 0 },    { 62, 0xcccc, 0x3333, 0x9999,  0, 0 },    { 63, 0xcccc, 0x3333, 0x6666,  0, 0 },    { 64, 0xcccc, 0x3333, 0x3333,  0, 0 },    { 65, 0xcccc, 0x3333, 0x0000,  0, 0 },    { 66, 0xcccc, 0x0000, 0xffff,  0, 0 },    { 67, 0xcccc, 0x0000, 0xcccc,  0, 0 },    { 68, 0xcccc, 0x0000, 0x9999,  0, 0 },    { 69, 0xcccc, 0x0000, 0x6666,  0, 0 },    { 70, 0xcccc, 0x0000, 0x3333,  0, 0 },    { 71, 0xcccc, 0x0000, 0x0000,  0, 0 },    { 72, 0x9999, 0xffff, 0xffff,  0, 0 },    { 73, 0x9999, 0xffff, 0xcccc,  0, 0 },    { 74, 0x9999, 0xffff, 0x9999,  0, 0 },    { 75, 0x9999, 0xffff, 0x6666,  0, 0 },    { 76, 0x9999, 0xffff, 0x3333,  0, 0 },    { 77, 0x9999, 0xffff, 0x0000,  0, 0 },    { 78, 0x9999, 0xcccc, 0xffff,  0, 0 },    { 79, 0x9999, 0xcccc, 0xcccc,  0, 0 },    { 80, 0x9999, 0xcccc, 0x9999,  0, 0 },    { 81, 0x9999, 0xcccc, 0x6666,  0, 0 },    { 82, 0x9999, 0xcccc, 0x3333,  0, 0 },    { 83, 0x9999, 0xcccc, 0x0000,  0, 0 },    { 84, 0x9999, 0x9999, 0xffff,  0, 0 },    { 85, 0x9999, 0x9999, 0xcccc,  0, 0 },    { 86, 0x9999, 0x9999, 0x9999,  0, 0 },    { 87, 0x9999, 0x9999, 0x6666,  0, 0 },    { 88, 0x9999, 0x9999, 0x3333,  0, 0 },    { 89, 0x9999, 0x9999, 0x0000,  0, 0 },    { 90, 0x9999, 0x6666, 0xffff,  0, 0 },    { 91, 0x9999, 0x6666, 0xcccc,  0, 0 },    { 92, 0x9999, 0x6666, 0x9999,  0, 0 },    { 93, 0x9999, 0x6666, 0x6666,  0, 0 },    { 94, 0x9999, 0x6666, 0x3333,  0, 0 },    { 95, 0x9999, 0x6666, 0x0000,  0, 0 },    { 96, 0x9999, 0x3333, 0xffff,  0, 0 },    { 97, 0x9999, 0x3333, 0xcccc,  0, 0 },    { 98, 0x9999, 0x3333, 0x9999,  0, 0 },    { 99, 0x9999, 0x3333, 0x6666,  0, 0 },    { 100, 0x9999, 0x3333, 0x3333,  0, 0 },    { 101, 0x9999, 0x3333, 0x0000,  0, 0 },    { 102, 0x9999, 0x0000, 0xffff,  0, 0 },    { 103, 0x9999, 0x0000, 0xcccc,  0, 0 },    { 104, 0x9999, 0x0000, 0x9999,  0, 0 },    { 105, 0x9999, 0x0000, 0x6666,  0, 0 },    { 106, 0x9999, 0x0000, 0x3333,  0, 0 },    { 107, 0x9999, 0x0000, 0x0000,  0, 0 },    { 108, 0x6666, 0xffff, 0xffff,  0, 0 },    { 109, 0x6666, 0xffff, 0xcccc,  0, 0 },    { 110, 0x6666, 0xffff, 0x9999,  0, 0 },    { 111, 0x6666, 0xffff, 0x6666,  0, 0 },    { 112, 0x6666, 0xffff, 0x3333,  0, 0 },    { 113, 0x6666, 0xffff, 0x0000,  0, 0 },    { 114, 0x6666, 0xcccc, 0xffff,  0, 0 },    { 115, 0x6666, 0xcccc, 0xcccc,  0, 0 },    { 116, 0x6666, 0xcccc, 0x9999,  0, 0 },    { 117, 0x6666, 0xcccc, 0x6666,  0, 0 },    { 118, 0x6666, 0xcccc, 0x3333,  0, 0 },    { 119, 0x6666, 0xcccc, 0x0000,  0, 0 },    { 120, 0x6666, 0x9999, 0xffff,  0, 0 },    { 121, 0x6666, 0x9999, 0xcccc,  0, 0 },    { 122, 0x6666, 0x9999, 0x9999,  0, 0 },    { 123, 0x6666, 0x9999, 0x6666,  0, 0 },    { 124, 0x6666, 0x9999, 0x3333,  0, 0 },    { 125, 0x6666, 0x9999, 0x0000,  0, 0 },    { 126, 0x6666, 0x6666, 0xffff,  0, 0 },    { 127, 0x6666, 0x6666, 0xcccc,  0, 0 },    { 128, 0x6666, 0x6666, 0x9999,  0, 0 },    { 129, 0x6666, 0x6666, 0x6666,  0, 0 },    { 130, 0x6666, 0x6666, 0x3333,  0, 0 },    { 131, 0x6666, 0x6666, 0x0000,  0, 0 },    { 132, 0x6666, 0x3333, 0xffff,  0, 0 },    { 133, 0x6666, 0x3333, 0xcccc,  0, 0 },    { 134, 0x6666, 0x3333, 0x9999,  0, 0 },    { 135, 0x6666, 0x3333, 0x6666,  0, 0 },    { 136, 0x6666, 0x3333, 0x3333,  0, 0 },    { 137, 0x6666, 0x3333, 0x0000,  0, 0 },    { 138, 0x6666, 0x0000, 0xffff,  0, 0 },    { 139, 0x6666, 0x0000, 0xcccc,  0, 0 },    { 140, 0x6666, 0x0000, 0x9999,  0, 0 },    { 141, 0x6666, 0x0000, 0x6666,  0, 0 },    { 142, 0x6666, 0x0000, 0x3333,  0, 0 },    { 143, 0x6666, 0x0000, 0x0000,  0, 0 },    { 144, 0x3333, 0xffff, 0xffff,  0, 0 },    { 145, 0x3333, 0xffff, 0xcccc,  0, 0 },    { 146, 0x3333, 0xffff, 0x9999,  0, 0 },    { 147, 0x3333, 0xffff, 0x6666,  0, 0 },    { 148, 0x3333, 0xffff, 0x3333,  0, 0 },    { 149, 0x3333, 0xffff, 0x0000,  0, 0 },    { 150, 0x3333, 0xcccc, 0xffff,  0, 0 },    { 151, 0x3333, 0xcccc, 0xcccc,  0, 0 },    { 152, 0x3333, 0xcccc, 0x9999,  0, 0 },    { 153, 0x3333, 0xcccc, 0x6666,  0, 0 },    { 154, 0x3333, 0xcccc, 0x3333,  0, 0 },    { 155, 0x3333, 0xcccc, 0x0000,  0, 0 },    { 156, 0x3333, 0x9999, 0xffff,  0, 0 },    { 157, 0x3333, 0x9999, 0xcccc,  0, 0 },    { 158, 0x3333, 0x9999, 0x9999,  0, 0 },    { 159, 0x3333, 0x9999, 0x6666,  0, 0 },    { 160, 0x3333, 0x9999, 0x3333,  0, 0 },    { 161, 0x3333, 0x9999, 0x0000,  0, 0 },    { 162, 0x3333, 0x6666, 0xffff,  0, 0 },    { 163, 0x3333, 0x6666, 0xcccc,  0, 0 },    { 164, 0x3333, 0x6666, 0x9999,  0, 0 },    { 165, 0x3333, 0x6666, 0x6666,  0, 0 },    { 166, 0x3333, 0x6666, 0x3333,  0, 0 },    { 167, 0x3333, 0x6666, 0x0000,  0, 0 },    { 168, 0x3333, 0x3333, 0xffff,  0, 0 },    { 169, 0x3333, 0x3333, 0xcccc,  0, 0 },    { 170, 0x3333, 0x3333, 0x9999,  0, 0 },    { 171, 0x3333, 0x3333, 0x6666,  0, 0 },    { 172, 0x3333, 0x3333, 0x3333,  0, 0 },    { 173, 0x3333, 0x3333, 0x0000,  0, 0 },    { 174, 0x3333, 0x0000, 0xffff,  0, 0 },    { 175, 0x3333, 0x0000, 0xcccc,  0, 0 },    { 176, 0x3333, 0x0000, 0x9999,  0, 0 },    { 177, 0x3333, 0x0000, 0x6666,  0, 0 },    { 178, 0x3333, 0x0000, 0x3333,  0, 0 },    { 179, 0x3333, 0x0000, 0x0000,  0, 0 },    { 180, 0x0000, 0xffff, 0xffff,  0, 0 },    { 181, 0x0000, 0xffff, 0xcccc,  0, 0 },    { 182, 0x0000, 0xffff, 0x9999,  0, 0 },    { 183, 0x0000, 0xffff, 0x6666,  0, 0 },    { 184, 0x0000, 0xffff, 0x3333,  0, 0 },    { 185, 0x0000, 0xffff, 0x0000,  0, 0 },    { 186, 0x0000, 0xcccc, 0xffff,  0, 0 },    { 187, 0x0000, 0xcccc, 0xcccc,  0, 0 },    { 188, 0x0000, 0xcccc, 0x9999,  0, 0 },    { 189, 0x0000, 0xcccc, 0x6666,  0, 0 },    { 190, 0x0000, 0xcccc, 0x3333,  0, 0 },    { 191, 0x0000, 0xcccc, 0x0000,  0, 0 },    { 192, 0x0000, 0x9999, 0xffff,  0, 0 },    { 193, 0x0000, 0x9999, 0xcccc,  0, 0 },    { 194, 0x0000, 0x9999, 0x9999,  0, 0 },    { 195, 0x0000, 0x9999, 0x6666,  0, 0 },    { 196, 0x0000, 0x9999, 0x3333,  0, 0 },    { 197, 0x0000, 0x9999, 0x0000,  0, 0 },    { 198, 0x0000, 0x6666, 0xffff,  0, 0 },    { 199, 0x0000, 0x6666, 0xcccc,  0, 0 },    { 200, 0x0000, 0x6666, 0x9999,  0, 0 },    { 201, 0x0000, 0x6666, 0x6666,  0, 0 },    { 202, 0x0000, 0x6666, 0x3333,  0, 0 },    { 203, 0x0000, 0x6666, 0x0000,  0, 0 },    { 204, 0x0000, 0x3333, 0xffff,  0, 0 },    { 205, 0x0000, 0x3333, 0xcccc,  0, 0 },    { 206, 0x0000, 0x3333, 0x9999,  0, 0 },    { 207, 0x0000, 0x3333, 0x6666,  0, 0 },    { 208, 0x0000, 0x3333, 0x3333,  0, 0 },    { 209, 0x0000, 0x3333, 0x0000,  0, 0 },    { 210, 0x0000, 0x0000, 0xffff,  0, 0 },    { 211, 0x0000, 0x0000, 0xcccc,  0, 0 },    { 212, 0x0000, 0x0000, 0x9999,  0, 0 },    { 213, 0x0000, 0x0000, 0x6666,  0, 0 },    { 214, 0x0000, 0x0000, 0x3333,  0, 0 },    { 215, 0xeeee, 0x0000, 0x0000,  0, 0 },    { 216, 0xdddd, 0x0000, 0x0000,  0, 0 },    { 217, 0xbbbb, 0x0000, 0x0000,  0, 0 },    { 218, 0xaaaa, 0x0000, 0x0000,  0, 0 },    { 219, 0x8888, 0x0000, 0x0000,  0, 0 },    { 220, 0x7777, 0x0000, 0x0000,  0, 0 },    { 221, 0x5555, 0x0000, 0x0000,  0, 0 },    { 222, 0x4444, 0x0000, 0x0000,  0, 0 },    { 223, 0x2222, 0x0000, 0x0000,  0, 0 },    { 224, 0x1111, 0x0000, 0x0000,  0, 0 },    { 225, 0x0000, 0xeeee, 0x0000,  0, 0 },    { 226, 0x0000, 0xdddd, 0x0000,  0, 0 },    { 227, 0x0000, 0xbbbb, 0x0000,  0, 0 },    { 228, 0x0000, 0xaaaa, 0x0000,  0, 0 },    { 229, 0x0000, 0x8888, 0x0000,  0, 0 },    { 230, 0x0000, 0x7777, 0x0000,  0, 0 },    { 231, 0x0000, 0x5555, 0x0000,  0, 0 },    { 232, 0x0000, 0x4444, 0x0000,  0, 0 },    { 233, 0x0000, 0x2222, 0x0000,  0, 0 },    { 234, 0x0000, 0x1111, 0x0000,  0, 0 },    { 235, 0x0000, 0x0000, 0xeeee,  0, 0 },    { 236, 0x0000, 0x0000, 0xdddd,  0, 0 },    { 237, 0x0000, 0x0000, 0xbbbb,  0, 0 },    { 238, 0x0000, 0x0000, 0xaaaa,  0, 0 },    { 239, 0x0000, 0x0000, 0x8888,  0, 0 },    { 240, 0x0000, 0x0000, 0x7777,  0, 0 },    { 241, 0x0000, 0x0000, 0x5555,  0, 0 },    { 242, 0x0000, 0x0000, 0x4444,  0, 0 },    { 243, 0x0000, 0x0000, 0x2222,  0, 0 },    { 244, 0x0000, 0x0000, 0x1111,  0, 0 },    { 245, 0xeeee, 0xeeee, 0xeeee,  0, 0 },    { 246, 0xdddd, 0xdddd, 0xdddd,  0, 0 },    { 247, 0xbbbb, 0xbbbb, 0xbbbb,  0, 0 },    { 248, 0xaaaa, 0xaaaa, 0xaaaa,  0, 0 },    { 249, 0x8888, 0x8888, 0x8888,  0, 0 },    { 250, 0x7777, 0x7777, 0x7777,  0, 0 },    { 251, 0x5555, 0x5555, 0x5555,  0, 0 },    { 252, 0x4444, 0x4444, 0x4444,  0, 0 },    { 253, 0x2222, 0x2222, 0x2222,  0, 0 },    { 254, 0x1111, 0x1111, 0x1111,  0, 0 },    { 255, 0xffff, 0xffff, 0xffff,  0, 0 }};#endif /* _DARWIN_CLUT8_ */
\ No newline at end of file
+/*
+ * Darwin default 8-bit Colormap for StaticColor
+ */
+/* $XFree86: xc/programs/Xserver/hw/darwin/darwinClut8.h,v 1.1.8.1 2003/03/04 01:31:43 torrey Exp $ */
+
+#ifndef _DARWIN_CLUT8_
+#define _DARWIN_CLUT8_
+
+#ifdef USE_NEW_CLUT
+
+static xColorItem darwinClut8[] = {    
+    { 0, 0xffff, 0xffff, 0xffff,  0, 0 },
+    { 1, 0xfefe, 0xfefe, 0xfefe,  0, 0 },
+    { 2, 0xfdfd, 0xfdfd, 0xfdfd,  0, 0 },
+    { 3, 0xb8b8, 0x2727, 0x2b2b,  0, 0 },
+    { 4, 0xfcfc, 0xfcfc, 0xfcfc,  0, 0 },
+    { 5, 0xffff, 0xffff, 0x0,  0, 0 },
+    { 6, 0xfafa, 0xfafa, 0xfafa,  0, 0 },
+    { 7, 0xf9f9, 0xf9f9, 0xf9f9,  0, 0 },
+    { 8, 0xf8f8, 0xf8f8, 0xf8f8,  0, 0 },
+    { 9, 0xf7f7, 0xf7f7, 0xf7f7,  0, 0 },
+    { 10, 0xf6f6, 0xf6f6, 0xf6f6,  0, 0 },
+    { 11, 0xf5f5, 0xf5f5, 0xf5f5,  0, 0 },
+    { 12, 0xf4f4, 0xf4f4, 0xf4f4,  0, 0 },
+    { 13, 0xf2f2, 0xf2f2, 0xf2f2,  0, 0 },
+    { 14, 0xf1f1, 0xf1f1, 0xf1f1,  0, 0 },
+    { 15, 0x0, 0x0, 0x0,  0, 0 },
+    { 16, 0xefef, 0xefef, 0xefef,  0, 0 },
+    { 17, 0xeeee, 0xeeee, 0xeeee,  0, 0 },
+    { 18, 0xeded, 0xeded, 0xeded,  0, 0 },
+    { 19, 0xebeb, 0xebeb, 0xebeb,  0, 0 },
+    { 20, 0xe8e8, 0xe8e8, 0xe8e8,  0, 0 },
+    { 21, 0xe7e7, 0xe7e7, 0xe7e7,  0, 0 },
+    { 22, 0xc9c9, 0x3838, 0x3e3e,  0, 0 },
+    { 23, 0xe5e5, 0xe5e5, 0xe5e5,  0, 0 },
+    { 24, 0xffff, 0x0, 0xffff,  0, 0 },
+    { 25, 0xfbfb, 0xfbfb, 0xfbfb,  0, 0 },
+    { 26, 0xdede, 0x6c6c, 0x7272,  0, 0 },
+    { 27, 0xe0e0, 0xe0e0, 0xe0e0,  0, 0 },
+    { 28, 0xe8e8, 0x8686, 0x9090,  0, 0 },
+    { 29, 0xdede, 0xdede, 0xdede,  0, 0 },
+    { 30, 0xdddd, 0xdddd, 0xdddd,  0, 0 },
+    { 31, 0xd3d3, 0x7e7e, 0x8d8d,  0, 0 },
+    { 32, 0xd9d9, 0xd9d9, 0xd9d9,  0, 0 },
+    { 33, 0xf3f3, 0x9696, 0xa6a6,  0, 0 },
+    { 34, 0xb1b1, 0x1c1c, 0x3939,  0, 0 },
+    { 35, 0xffff, 0x0, 0x0,  0, 0 },
+    { 36, 0xbebe, 0x5e5e, 0x7272,  0, 0 },
+    { 37, 0xd3d3, 0xd3d3, 0xd3d3,  0, 0 },
+    { 38, 0xc6c6, 0x2e2e, 0x6767,  0, 0 },
+    { 39, 0xd1d1, 0xd1d1, 0xd1d1,  0, 0 },
+    { 40, 0xa3a3, 0x606, 0x4545,  0, 0 },
+    { 41, 0xcece, 0xcece, 0xcece,  0, 0 },
+    { 42, 0xcccc, 0xcccc, 0xffff,  0, 0 },
+    { 43, 0xcccc, 0xcccc, 0xcccc,  0, 0 },
+    { 44, 0xc6c6, 0x8f8f, 0xa7a7,  0, 0 },
+    { 45, 0xe1e1, 0xd3d3, 0xd9d9,  0, 0 },
+    { 46, 0xcece, 0x9e9e, 0xb4b4,  0, 0 },
+    { 47, 0xcaca, 0xcaca, 0xcaca,  0, 0 },
+    { 48, 0xbfbf, 0x3f3f, 0x7d7d,  0, 0 },
+    { 49, 0xc9c9, 0xc9c9, 0xc9c9,  0, 0 },
+    { 50, 0xf4f4, 0x8989, 0xbebe,  0, 0 },
+    { 51, 0xc6c6, 0xc6c6, 0xc6c6,  0, 0 },
+    { 52, 0xd6d6, 0x5151, 0x9797,  0, 0 },
+    { 53, 0xc9c9, 0x2c2c, 0x8484,  0, 0 },
+    { 54, 0x9696, 0x1a1a, 0x6a6a,  0, 0 },
+    { 55, 0xc2c2, 0xc2c2, 0xc2c2,  0, 0 },
+    { 56, 0xf3f3, 0x6f6f, 0xc6c6,  0, 0 },
+    { 57, 0xe5e5, 0x4c4c, 0xbbbb,  0, 0 },
+    { 58, 0xb7b7, 0x5a5a, 0x9c9c,  0, 0 },
+    { 59, 0xbfbf, 0xbfbf, 0xbfbf,  0, 0 },
+    { 60, 0xbebe, 0xbebe, 0xbebe,  0, 0 },
+    { 61, 0xbdbd, 0xbdbd, 0xbdbd,  0, 0 },
+    { 62, 0xb8b8, 0x2121, 0xa2a2,  0, 0 },
+    { 63, 0xd3d3, 0x4444, 0xc0c0,  0, 0 },
+    { 64, 0xc2c2, 0x6666, 0xb7b7,  0, 0 },
+    { 65, 0xf4f4, 0x6666, 0xe6e6,  0, 0 },
+    { 66, 0xfcfc, 0x7373, 0xfdfd,  0, 0 },
+    { 67, 0xb9b9, 0xb9b9, 0xb9b9,  0, 0 },
+    { 68, 0xeaea, 0xdfdf, 0xeaea,  0, 0 },
+    { 69, 0xd4d4, 0x7171, 0xd5d5,  0, 0 },
+    { 70, 0xf9f9, 0x8b8b, 0xffff,  0, 0 },
+    { 71, 0xf5f5, 0xadad, 0xffff,  0, 0 },
+    { 72, 0xbcbc, 0x9292, 0xc2c2,  0, 0 },
+    { 73, 0xc7c7, 0x4f4f, 0xd9d9,  0, 0 },
+    { 74, 0xa0a0, 0x4444, 0xafaf,  0, 0 },
+    { 75, 0xc8c8, 0x8c8c, 0xd5d5,  0, 0 },
+    { 76, 0xd7d7, 0x7474, 0xf7f7,  0, 0 },
+    { 77, 0xb4b4, 0xb4b4, 0xb4b4,  0, 0 },
+    { 78, 0xdada, 0x9595, 0xf9f9,  0, 0 },
+    { 79, 0xeded, 0xcbcb, 0xffff,  0, 0 },
+    { 80, 0xb2b2, 0xb2b2, 0xb2b2,  0, 0 },
+    { 81, 0xa1a1, 0x6161, 0xd7d7,  0, 0 },
+    { 82, 0xb2b2, 0x8585, 0xe2e2,  0, 0 },
+    { 83, 0x5959, 0x2626, 0x9c9c,  0, 0 },
+    { 84, 0x7c7c, 0x5151, 0xcccc,  0, 0 },
+    { 85, 0xb0b0, 0xb0b0, 0xb0b0,  0, 0 },
+    { 86, 0xb4b4, 0x8e8e, 0xfcfc,  0, 0 },
+    { 87, 0xd5d5, 0xc0c0, 0xffff,  0, 0 },
+    { 88, 0x5d5d, 0x3232, 0xcccc,  0, 0 },
+    { 89, 0x7b7b, 0x5c5c, 0xe5e5,  0, 0 },
+    { 90, 0xc0c0, 0xb0b0, 0xfdfd,  0, 0 },
+    { 91, 0x6060, 0x5353, 0xadad,  0, 0 },
+    { 92, 0x1212, 0xc0c, 0x7e7e,  0, 0 },
+    { 93, 0x2e2e, 0x2929, 0x9999,  0, 0 },
+    { 94, 0x7979, 0x7878, 0xe9e9,  0, 0 },
+    { 95, 0x5b5b, 0x5c5c, 0xd0d0,  0, 0 },
+    { 96, 0x6969, 0x6a6a, 0xcccc,  0, 0 },
+    { 97, 0x9393, 0x9494, 0xf8f8,  0, 0 },
+    { 98, 0x9292, 0x9292, 0xc3c3,  0, 0 },
+    { 99, 0x4141, 0x4444, 0xbaba,  0, 0 },
+    { 100, 0xa8a8, 0xabab, 0xffff,  0, 0 },
+    { 101, 0xa3a3, 0xa3a3, 0xa3a3,  0, 0 },
+    { 102, 0xdbdb, 0xdddd, 0xeaea,  0, 0 },
+    { 103, 0x3131, 0x4949, 0xaaaa,  0, 0 },
+    { 104, 0x7070, 0x8f8f, 0xf9f9,  0, 0 },
+    { 105, 0x4848, 0x6666, 0xc1c1,  0, 0 },
+    { 106, 0x5c5c, 0x7e7e, 0xe9e9,  0, 0 },
+    { 107, 0xe2e2, 0xe5e5, 0xebeb,  0, 0 },
+    { 108, 0xb0b0, 0xcdcd, 0xffff,  0, 0 },
+    { 109, 0x6c6c, 0x8989, 0xb7b7,  0, 0 },
+    { 110, 0x3434, 0x6565, 0xafaf,  0, 0 },
+    { 111, 0x8c8c, 0xb9b9, 0xffff,  0, 0 },
+    { 112, 0x3737, 0x7979, 0xd4d4,  0, 0 },
+    { 113, 0x5a5a, 0x9999, 0xeaea,  0, 0 },
+    { 114, 0xe0e, 0x4c4c, 0x9595,  0, 0 },
+    { 115, 0x7979, 0xb9b9, 0xffff,  0, 0 },
+    { 116, 0x8a8a, 0xa3a3, 0xbcbc,  0, 0 },
+    { 117, 0x2020, 0x6161, 0x9d9d,  0, 0 },
+    { 118, 0x8f8f, 0xaeae, 0xcaca,  0, 0 },
+    { 119, 0xa0a, 0x6060, 0xa8a8,  0, 0 },
+    { 120, 0x3f3f, 0x9494, 0xd9d9,  0, 0 },
+    { 121, 0x6363, 0xb5b5, 0xf9f9,  0, 0 },
+    { 122, 0xe2e2, 0xe8e8, 0xeded,  0, 0 },
+    { 123, 0x2828, 0x6a6a, 0x9999,  0, 0 },
+    { 124, 0x5555, 0xb2b2, 0xe7e7,  0, 0 },
+    { 125, 0x3232, 0x8989, 0xa9a9,  0, 0 },
+    { 126, 0xcfcf, 0xdada, 0xdede,  0, 0 },
+    { 127, 0x2929, 0xa1a1, 0xc7c7,  0, 0 },
+    { 128, 0x8686, 0xa9a9, 0xb4b4,  0, 0 },
+    { 129, 0x0, 0x5f5f, 0x7979,  0, 0 },
+    { 130, 0xc0c, 0x7777, 0x8e8e,  0, 0 },
+    { 131, 0x1212, 0x8f8f, 0xabab,  0, 0 },
+    { 132, 0x4141, 0xbaba, 0xd5d5,  0, 0 },
+    { 133, 0x2424, 0x8282, 0x8383,  0, 0 },
+    { 134, 0x2c2c, 0xc4c4, 0xc3c3,  0, 0 },
+    { 135, 0x1a1a, 0xabab, 0xa6a6,  0, 0 },
+    { 136, 0x4b4b, 0xa8a8, 0xa2a2,  0, 0 },
+    { 137, 0xa0a, 0x9393, 0x8585,  0, 0 },
+    { 138, 0xd0d, 0xa5a5, 0x9696,  0, 0 },
+    { 139, 0x2626, 0xbcbc, 0xacac,  0, 0 },
+    { 140, 0x404, 0x8181, 0x7272,  0, 0 },
+    { 141, 0x1919, 0xb3b3, 0x8686,  0, 0 },
+    { 142, 0x2929, 0xc1c1, 0x9494,  0, 0 },
+    { 143, 0x2121, 0x9c9c, 0x7171,  0, 0 },
+    { 144, 0x202, 0x8c8c, 0x5050,  0, 0 },
+    { 145, 0x3535, 0xd0d0, 0x8989,  0, 0 },
+    { 146, 0x4646, 0xa5a5, 0x7676,  0, 0 },
+    { 147, 0x202, 0x7d7d, 0x3939,  0, 0 },
+    { 148, 0x2929, 0xc9c9, 0x7171,  0, 0 },
+    { 149, 0x5757, 0xd6d6, 0x8f8f,  0, 0 },
+    { 150, 0xa2a2, 0xb5b5, 0xaaaa,  0, 0 },
+    { 151, 0x101, 0x8888, 0x2a2a,  0, 0 },
+    { 152, 0x7474, 0xbebe, 0x8a8a,  0, 0 },
+    { 153, 0x1919, 0xb6b6, 0x4747,  0, 0 },
+    { 154, 0x2d2d, 0xc6c6, 0x5151,  0, 0 },
+    { 155, 0x3838, 0xdede, 0x5d5d,  0, 0 },
+    { 156, 0x4c4c, 0xf4f4, 0x6f6f,  0, 0 },
+    { 157, 0x9191, 0x9c9c, 0x9393,  0, 0 },
+    { 158, 0x0, 0x8e8e, 0x1919,  0, 0 },
+    { 159, 0x1010, 0xafaf, 0x2828,  0, 0 },
+    { 160, 0xe3e3, 0xe3e3, 0xe3e3,  0, 0 },
+    { 161, 0x808, 0xa1a1, 0x1a1a,  0, 0 },
+    { 162, 0x5959, 0xc2c2, 0x6161,  0, 0 },
+    { 163, 0xf0f0, 0xf0f0, 0xf0f0,  0, 0 },
+    { 164, 0x8f8f, 0x9c9c, 0x9090,  0, 0 },
+    { 165, 0x2323, 0xcece, 0x2a2a,  0, 0 },
+    { 166, 0x1212, 0xbaba, 0x1717,  0, 0 },
+    { 167, 0x101, 0x8a8a, 0x202,  0, 0 },
+    { 168, 0x303, 0x9a9a, 0x202,  0, 0 },
+    { 169, 0x4040, 0xe4e4, 0x4040,  0, 0 },
+    { 170, 0x808, 0xb2b2, 0x505,  0, 0 },
+    { 171, 0x1313, 0xcccc, 0xf0f,  0, 0 },
+    { 172, 0x3636, 0xd7d7, 0x3232,  0, 0 },
+    { 173, 0x2828, 0xe9e9, 0x1f1f,  0, 0 },
+    { 174, 0x5353, 0xfbfb, 0x4c4c,  0, 0 },
+    { 175, 0x6f6f, 0xafaf, 0x6a6a,  0, 0 },
+    { 176, 0x7171, 0xe0e0, 0x6767,  0, 0 },
+    { 177, 0x3232, 0xc0c0, 0x1212,  0, 0 },
+    { 178, 0x2929, 0xa5a5, 0x808,  0, 0 },
+    { 179, 0x5c5c, 0xdddd, 0x3535,  0, 0 },
+    { 180, 0x0, 0xffff, 0xffff,  0, 0 },
+    { 181, 0x6363, 0xc8c8, 0x4545,  0, 0 },
+    { 182, 0x8686, 0xfdfd, 0x5b5b,  0, 0 },
+    { 183, 0x7171, 0xf6f6, 0x3939,  0, 0 },
+    { 184, 0x5555, 0xcccc, 0x1515,  0, 0 },
+    { 185, 0x0, 0xffff, 0x0,  0, 0 },
+    { 186, 0x9090, 0xcaca, 0x6e6e,  0, 0 },
+    { 187, 0x4343, 0xa7a7, 0x101,  0, 0 },
+    { 188, 0x8d8d, 0xe4e4, 0x3737,  0, 0 },
+    { 189, 0xb3b3, 0xf0f0, 0x6464,  0, 0 },
+    { 190, 0x8585, 0x8e8e, 0x7a7a,  0, 0 },
+    { 191, 0xb0b0, 0xfafa, 0x4d4d,  0, 0 },
+    { 192, 0xd6d6, 0xd6d6, 0xd6d6,  0, 0 },
+    { 193, 0x8888, 0xd0d0, 0x1a1a,  0, 0 },
+    { 194, 0x6a6a, 0xa7a7, 0x303,  0, 0 },
+    { 195, 0x9898, 0xbfbf, 0x4141,  0, 0 },
+    { 196, 0xcdcd, 0xf8f8, 0x5151,  0, 0 },
+    { 197, 0x9494, 0xa4a4, 0x5555,  0, 0 },
+    { 198, 0x9191, 0xb0b0, 0xa0a,  0, 0 },
+    { 199, 0xdada, 0xf1f1, 0x3c3c,  0, 0 },
+    { 200, 0xbaba, 0xcaca, 0x5353,  0, 0 },
+    { 201, 0xb9b9, 0xc3c3, 0x2828,  0, 0 },
+    { 202, 0xb1b1, 0xbaba, 0x1212,  0, 0 },
+    { 203, 0xd2d2, 0xd9d9, 0x2626,  0, 0 },
+    { 204, 0xe8e8, 0xecec, 0x2d2d,  0, 0 },
+    { 205, 0x9898, 0x9696, 0x202,  0, 0 },
+    { 206, 0xadad, 0xadad, 0x5c5c,  0, 0 },
+    { 207, 0xe2e2, 0xd8d8, 0x3838,  0, 0 },
+    { 208, 0xd9d9, 0xc4c4, 0x3838,  0, 0 },
+    { 209, 0xa8a8, 0x9a9a, 0x5050,  0, 0 },
+    { 210, 0x0, 0x0, 0xffff,  0, 0 },
+    { 211, 0xbebe, 0xaeae, 0x5e5e,  0, 0 },
+    { 212, 0x9a9a, 0x9898, 0x8e8e,  0, 0 },
+    { 213, 0xacac, 0x8d8d, 0xd0d,  0, 0 },
+    { 214, 0xc5c5, 0xa0a0, 0x2b2b,  0, 0 },
+    { 215, 0xdbdb, 0xb5b5, 0x4848,  0, 0 },
+    { 216, 0xdddd, 0x0, 0x0,  0, 0 },
+    { 217, 0x9c9c, 0x6d6d, 0x303,  0, 0 },
+    { 218, 0xd4d4, 0xa8a8, 0x4747,  0, 0 },
+    { 219, 0xb7b7, 0x7171, 0x1717,  0, 0 },
+    { 220, 0xdcdc, 0xa1a1, 0x5a5a,  0, 0 },
+    { 221, 0xb9b9, 0x9c9c, 0x7c7c,  0, 0 },
+    { 222, 0xb4b4, 0xabab, 0xa2a2,  0, 0 },
+    { 223, 0x9e9e, 0x4b4b, 0x101,  0, 0 },
+    { 224, 0xc8c8, 0x7878, 0x3535,  0, 0 },
+    { 225, 0xd2d2, 0x8d8d, 0x5151,  0, 0 },
+    { 226, 0xadad, 0x5252, 0xf0f,  0, 0 },
+    { 227, 0x0, 0xbbbb, 0x0,  0, 0 },
+    { 228, 0xb2b2, 0x6666, 0x3838,  0, 0 },
+    { 229, 0xb1b1, 0xa6a6, 0x9f9f,  0, 0 },
+    { 230, 0xb1b1, 0x8787, 0x6f6f,  0, 0 },
+    { 231, 0xa4a4, 0x3434, 0x303,  0, 0 },
+    { 232, 0xeeee, 0x9e9e, 0x8585,  0, 0 },
+    { 233, 0xc9c9, 0x7373, 0x5a5a,  0, 0 },
+    { 234, 0xe6e6, 0x9494, 0x7c7c,  0, 0 },
+    { 235, 0xa9a9, 0x2222, 0x606,  0, 0 },
+    { 236, 0xdbdb, 0x8787, 0x7474,  0, 0 },
+    { 237, 0xb0b0, 0x2e2e, 0x1515,  0, 0 },
+    { 238, 0xb7b7, 0x5a5a, 0x5050,  0, 0 },
+    { 239, 0xb2b2, 0x4242, 0x3b3b,  0, 0 },
+    { 240, 0xcdcd, 0x7373, 0x6e6e,  0, 0 },
+    { 241, 0xd9d9, 0x5858, 0x5858,  0, 0 },
+    { 242, 0xacac, 0xacac, 0xacac,  0, 0 },
+    { 243, 0xa0a0, 0xa0a0, 0xa0a0,  0, 0 },
+    { 244, 0x9a9a, 0x9a9a, 0x9a9a,  0, 0 },
+    { 245, 0x9292, 0x9292, 0x9292,  0, 0 },
+    { 246, 0x8e8e, 0x8e8e, 0x8e8e,  0, 0 },
+    { 247, 0xbbbb, 0xbbbb, 0xbbbb,  0, 0 },
+    { 248, 0x8181, 0x8181, 0x8181,  0, 0 },
+    { 249, 0x8888, 0x8888, 0x8888,  0, 0 },
+    { 250, 0x7777, 0x7777, 0x7777,  0, 0 },
+    { 251, 0x5555, 0x5555, 0x5555,  0, 0 },
+    { 252, 0x4444, 0x4444, 0x4444,  0, 0 },
+    { 253, 0x2222, 0x2222, 0x2222,  0, 0 },
+    { 254, 0x7b7b, 0x7b7b, 0x7b7b,  0, 0 },
+    { 255, 0x0, 0x0, 0x0,  0, 0 },
+};
+
+#else /* !USE_NEW_CLUT */
+
+static xColorItem darwinClut8[] = {
+    { 0, 0x0000, 0x0000, 0x0000,  0, 0 },
+    { 1, 0xffff, 0xffff, 0xcccc,  0, 0 },
+    { 2, 0xffff, 0xffff, 0x9999,  0, 0 },
+    { 3, 0xffff, 0xffff, 0x6666,  0, 0 },
+    { 4, 0xffff, 0xffff, 0x3333,  0, 0 },
+    { 5, 0xffff, 0xffff, 0x0000,  0, 0 },
+    { 6, 0xffff, 0xcccc, 0xffff,  0, 0 },
+    { 7, 0xffff, 0xcccc, 0xcccc,  0, 0 },
+    { 8, 0xffff, 0xcccc, 0x9999,  0, 0 },
+    { 9, 0xffff, 0xcccc, 0x6666,  0, 0 },
+    { 10, 0xffff, 0xcccc, 0x3333,  0, 0 },
+    { 11, 0xffff, 0xcccc, 0x0000,  0, 0 },
+    { 12, 0xffff, 0x9999, 0xffff,  0, 0 },
+    { 13, 0xffff, 0x9999, 0xcccc,  0, 0 },
+    { 14, 0xffff, 0x9999, 0x9999,  0, 0 },
+    { 15, 0xffff, 0x9999, 0x6666,  0, 0 },
+    { 16, 0xffff, 0x9999, 0x3333,  0, 0 },
+    { 17, 0xffff, 0x9999, 0x0000,  0, 0 },
+    { 18, 0xffff, 0x6666, 0xffff,  0, 0 },
+    { 19, 0xffff, 0x6666, 0xcccc,  0, 0 },
+    { 20, 0xffff, 0x6666, 0x9999,  0, 0 },
+    { 21, 0xffff, 0x6666, 0x6666,  0, 0 },
+    { 22, 0xffff, 0x6666, 0x3333,  0, 0 },
+    { 23, 0xffff, 0x6666, 0x0000,  0, 0 },
+    { 24, 0xffff, 0x3333, 0xffff,  0, 0 },
+    { 25, 0xffff, 0x3333, 0xcccc,  0, 0 },
+    { 26, 0xffff, 0x3333, 0x9999,  0, 0 },
+    { 27, 0xffff, 0x3333, 0x6666,  0, 0 },
+    { 28, 0xffff, 0x3333, 0x3333,  0, 0 },
+    { 29, 0xffff, 0x3333, 0x0000,  0, 0 },
+    { 30, 0xffff, 0x0000, 0xffff,  0, 0 },
+    { 31, 0xffff, 0x0000, 0xcccc,  0, 0 },
+    { 32, 0xffff, 0x0000, 0x9999,  0, 0 },
+    { 33, 0xffff, 0x0000, 0x6666,  0, 0 },
+    { 34, 0xffff, 0x0000, 0x3333,  0, 0 },
+    { 35, 0xffff, 0x0000, 0x0000,  0, 0 },
+    { 36, 0xcccc, 0xffff, 0xffff,  0, 0 },
+    { 37, 0xcccc, 0xffff, 0xcccc,  0, 0 },
+    { 38, 0xcccc, 0xffff, 0x9999,  0, 0 },
+    { 39, 0xcccc, 0xffff, 0x6666,  0, 0 },
+    { 40, 0xcccc, 0xffff, 0x3333,  0, 0 },
+    { 41, 0xcccc, 0xffff, 0x0000,  0, 0 },
+    { 42, 0xcccc, 0xcccc, 0xffff,  0, 0 },
+    { 43, 0xcccc, 0xcccc, 0xcccc,  0, 0 },
+    { 44, 0xcccc, 0xcccc, 0x9999,  0, 0 },
+    { 45, 0xcccc, 0xcccc, 0x6666,  0, 0 },
+    { 46, 0xcccc, 0xcccc, 0x3333,  0, 0 },
+    { 47, 0xcccc, 0xcccc, 0x0000,  0, 0 },
+    { 48, 0xcccc, 0x9999, 0xffff,  0, 0 },
+    { 49, 0xcccc, 0x9999, 0xcccc,  0, 0 },
+    { 50, 0xcccc, 0x9999, 0x9999,  0, 0 },
+    { 51, 0xcccc, 0x9999, 0x6666,  0, 0 },
+    { 52, 0xcccc, 0x9999, 0x3333,  0, 0 },
+    { 53, 0xcccc, 0x9999, 0x0000,  0, 0 },
+    { 54, 0xcccc, 0x6666, 0xffff,  0, 0 },
+    { 55, 0xcccc, 0x6666, 0xcccc,  0, 0 },
+    { 56, 0xcccc, 0x6666, 0x9999,  0, 0 },
+    { 57, 0xcccc, 0x6666, 0x6666,  0, 0 },
+    { 58, 0xcccc, 0x6666, 0x3333,  0, 0 },
+    { 59, 0xcccc, 0x6666, 0x0000,  0, 0 },
+    { 60, 0xcccc, 0x3333, 0xffff,  0, 0 },
+    { 61, 0xcccc, 0x3333, 0xcccc,  0, 0 },
+    { 62, 0xcccc, 0x3333, 0x9999,  0, 0 },
+    { 63, 0xcccc, 0x3333, 0x6666,  0, 0 },
+    { 64, 0xcccc, 0x3333, 0x3333,  0, 0 },
+    { 65, 0xcccc, 0x3333, 0x0000,  0, 0 },
+    { 66, 0xcccc, 0x0000, 0xffff,  0, 0 },
+    { 67, 0xcccc, 0x0000, 0xcccc,  0, 0 },
+    { 68, 0xcccc, 0x0000, 0x9999,  0, 0 },
+    { 69, 0xcccc, 0x0000, 0x6666,  0, 0 },
+    { 70, 0xcccc, 0x0000, 0x3333,  0, 0 },
+    { 71, 0xcccc, 0x0000, 0x0000,  0, 0 },
+    { 72, 0x9999, 0xffff, 0xffff,  0, 0 },
+    { 73, 0x9999, 0xffff, 0xcccc,  0, 0 },
+    { 74, 0x9999, 0xffff, 0x9999,  0, 0 },
+    { 75, 0x9999, 0xffff, 0x6666,  0, 0 },
+    { 76, 0x9999, 0xffff, 0x3333,  0, 0 },
+    { 77, 0x9999, 0xffff, 0x0000,  0, 0 },
+    { 78, 0x9999, 0xcccc, 0xffff,  0, 0 },
+    { 79, 0x9999, 0xcccc, 0xcccc,  0, 0 },
+    { 80, 0x9999, 0xcccc, 0x9999,  0, 0 },
+    { 81, 0x9999, 0xcccc, 0x6666,  0, 0 },
+    { 82, 0x9999, 0xcccc, 0x3333,  0, 0 },
+    { 83, 0x9999, 0xcccc, 0x0000,  0, 0 },
+    { 84, 0x9999, 0x9999, 0xffff,  0, 0 },
+    { 85, 0x9999, 0x9999, 0xcccc,  0, 0 },
+    { 86, 0x9999, 0x9999, 0x9999,  0, 0 },
+    { 87, 0x9999, 0x9999, 0x6666,  0, 0 },
+    { 88, 0x9999, 0x9999, 0x3333,  0, 0 },
+    { 89, 0x9999, 0x9999, 0x0000,  0, 0 },
+    { 90, 0x9999, 0x6666, 0xffff,  0, 0 },
+    { 91, 0x9999, 0x6666, 0xcccc,  0, 0 },
+    { 92, 0x9999, 0x6666, 0x9999,  0, 0 },
+    { 93, 0x9999, 0x6666, 0x6666,  0, 0 },
+    { 94, 0x9999, 0x6666, 0x3333,  0, 0 },
+    { 95, 0x9999, 0x6666, 0x0000,  0, 0 },
+    { 96, 0x9999, 0x3333, 0xffff,  0, 0 },
+    { 97, 0x9999, 0x3333, 0xcccc,  0, 0 },
+    { 98, 0x9999, 0x3333, 0x9999,  0, 0 },
+    { 99, 0x9999, 0x3333, 0x6666,  0, 0 },
+    { 100, 0x9999, 0x3333, 0x3333,  0, 0 },
+    { 101, 0x9999, 0x3333, 0x0000,  0, 0 },
+    { 102, 0x9999, 0x0000, 0xffff,  0, 0 },
+    { 103, 0x9999, 0x0000, 0xcccc,  0, 0 },
+    { 104, 0x9999, 0x0000, 0x9999,  0, 0 },
+    { 105, 0x9999, 0x0000, 0x6666,  0, 0 },
+    { 106, 0x9999, 0x0000, 0x3333,  0, 0 },
+    { 107, 0x9999, 0x0000, 0x0000,  0, 0 },
+    { 108, 0x6666, 0xffff, 0xffff,  0, 0 },
+    { 109, 0x6666, 0xffff, 0xcccc,  0, 0 },
+    { 110, 0x6666, 0xffff, 0x9999,  0, 0 },
+    { 111, 0x6666, 0xffff, 0x6666,  0, 0 },
+    { 112, 0x6666, 0xffff, 0x3333,  0, 0 },
+    { 113, 0x6666, 0xffff, 0x0000,  0, 0 },
+    { 114, 0x6666, 0xcccc, 0xffff,  0, 0 },
+    { 115, 0x6666, 0xcccc, 0xcccc,  0, 0 },
+    { 116, 0x6666, 0xcccc, 0x9999,  0, 0 },
+    { 117, 0x6666, 0xcccc, 0x6666,  0, 0 },
+    { 118, 0x6666, 0xcccc, 0x3333,  0, 0 },
+    { 119, 0x6666, 0xcccc, 0x0000,  0, 0 },
+    { 120, 0x6666, 0x9999, 0xffff,  0, 0 },
+    { 121, 0x6666, 0x9999, 0xcccc,  0, 0 },
+    { 122, 0x6666, 0x9999, 0x9999,  0, 0 },
+    { 123, 0x6666, 0x9999, 0x6666,  0, 0 },
+    { 124, 0x6666, 0x9999, 0x3333,  0, 0 },
+    { 125, 0x6666, 0x9999, 0x0000,  0, 0 },
+    { 126, 0x6666, 0x6666, 0xffff,  0, 0 },
+    { 127, 0x6666, 0x6666, 0xcccc,  0, 0 },
+    { 128, 0x6666, 0x6666, 0x9999,  0, 0 },
+    { 129, 0x6666, 0x6666, 0x6666,  0, 0 },
+    { 130, 0x6666, 0x6666, 0x3333,  0, 0 },
+    { 131, 0x6666, 0x6666, 0x0000,  0, 0 },
+    { 132, 0x6666, 0x3333, 0xffff,  0, 0 },
+    { 133, 0x6666, 0x3333, 0xcccc,  0, 0 },
+    { 134, 0x6666, 0x3333, 0x9999,  0, 0 },
+    { 135, 0x6666, 0x3333, 0x6666,  0, 0 },
+    { 136, 0x6666, 0x3333, 0x3333,  0, 0 },
+    { 137, 0x6666, 0x3333, 0x0000,  0, 0 },
+    { 138, 0x6666, 0x0000, 0xffff,  0, 0 },
+    { 139, 0x6666, 0x0000, 0xcccc,  0, 0 },
+    { 140, 0x6666, 0x0000, 0x9999,  0, 0 },
+    { 141, 0x6666, 0x0000, 0x6666,  0, 0 },
+    { 142, 0x6666, 0x0000, 0x3333,  0, 0 },
+    { 143, 0x6666, 0x0000, 0x0000,  0, 0 },
+    { 144, 0x3333, 0xffff, 0xffff,  0, 0 },
+    { 145, 0x3333, 0xffff, 0xcccc,  0, 0 },
+    { 146, 0x3333, 0xffff, 0x9999,  0, 0 },
+    { 147, 0x3333, 0xffff, 0x6666,  0, 0 },
+    { 148, 0x3333, 0xffff, 0x3333,  0, 0 },
+    { 149, 0x3333, 0xffff, 0x0000,  0, 0 },
+    { 150, 0x3333, 0xcccc, 0xffff,  0, 0 },
+    { 151, 0x3333, 0xcccc, 0xcccc,  0, 0 },
+    { 152, 0x3333, 0xcccc, 0x9999,  0, 0 },
+    { 153, 0x3333, 0xcccc, 0x6666,  0, 0 },
+    { 154, 0x3333, 0xcccc, 0x3333,  0, 0 },
+    { 155, 0x3333, 0xcccc, 0x0000,  0, 0 },
+    { 156, 0x3333, 0x9999, 0xffff,  0, 0 },
+    { 157, 0x3333, 0x9999, 0xcccc,  0, 0 },
+    { 158, 0x3333, 0x9999, 0x9999,  0, 0 },
+    { 159, 0x3333, 0x9999, 0x6666,  0, 0 },
+    { 160, 0x3333, 0x9999, 0x3333,  0, 0 },
+    { 161, 0x3333, 0x9999, 0x0000,  0, 0 },
+    { 162, 0x3333, 0x6666, 0xffff,  0, 0 },
+    { 163, 0x3333, 0x6666, 0xcccc,  0, 0 },
+    { 164, 0x3333, 0x6666, 0x9999,  0, 0 },
+    { 165, 0x3333, 0x6666, 0x6666,  0, 0 },
+    { 166, 0x3333, 0x6666, 0x3333,  0, 0 },
+    { 167, 0x3333, 0x6666, 0x0000,  0, 0 },
+    { 168, 0x3333, 0x3333, 0xffff,  0, 0 },
+    { 169, 0x3333, 0x3333, 0xcccc,  0, 0 },
+    { 170, 0x3333, 0x3333, 0x9999,  0, 0 },
+    { 171, 0x3333, 0x3333, 0x6666,  0, 0 },
+    { 172, 0x3333, 0x3333, 0x3333,  0, 0 },
+    { 173, 0x3333, 0x3333, 0x0000,  0, 0 },
+    { 174, 0x3333, 0x0000, 0xffff,  0, 0 },
+    { 175, 0x3333, 0x0000, 0xcccc,  0, 0 },
+    { 176, 0x3333, 0x0000, 0x9999,  0, 0 },
+    { 177, 0x3333, 0x0000, 0x6666,  0, 0 },
+    { 178, 0x3333, 0x0000, 0x3333,  0, 0 },
+    { 179, 0x3333, 0x0000, 0x0000,  0, 0 },
+    { 180, 0x0000, 0xffff, 0xffff,  0, 0 },
+    { 181, 0x0000, 0xffff, 0xcccc,  0, 0 },
+    { 182, 0x0000, 0xffff, 0x9999,  0, 0 },
+    { 183, 0x0000, 0xffff, 0x6666,  0, 0 },
+    { 184, 0x0000, 0xffff, 0x3333,  0, 0 },
+    { 185, 0x0000, 0xffff, 0x0000,  0, 0 },
+    { 186, 0x0000, 0xcccc, 0xffff,  0, 0 },
+    { 187, 0x0000, 0xcccc, 0xcccc,  0, 0 },
+    { 188, 0x0000, 0xcccc, 0x9999,  0, 0 },
+    { 189, 0x0000, 0xcccc, 0x6666,  0, 0 },
+    { 190, 0x0000, 0xcccc, 0x3333,  0, 0 },
+    { 191, 0x0000, 0xcccc, 0x0000,  0, 0 },
+    { 192, 0x0000, 0x9999, 0xffff,  0, 0 },
+    { 193, 0x0000, 0x9999, 0xcccc,  0, 0 },
+    { 194, 0x0000, 0x9999, 0x9999,  0, 0 },
+    { 195, 0x0000, 0x9999, 0x6666,  0, 0 },
+    { 196, 0x0000, 0x9999, 0x3333,  0, 0 },
+    { 197, 0x0000, 0x9999, 0x0000,  0, 0 },
+    { 198, 0x0000, 0x6666, 0xffff,  0, 0 },
+    { 199, 0x0000, 0x6666, 0xcccc,  0, 0 },
+    { 200, 0x0000, 0x6666, 0x9999,  0, 0 },
+    { 201, 0x0000, 0x6666, 0x6666,  0, 0 },
+    { 202, 0x0000, 0x6666, 0x3333,  0, 0 },
+    { 203, 0x0000, 0x6666, 0x0000,  0, 0 },
+    { 204, 0x0000, 0x3333, 0xffff,  0, 0 },
+    { 205, 0x0000, 0x3333, 0xcccc,  0, 0 },
+    { 206, 0x0000, 0x3333, 0x9999,  0, 0 },
+    { 207, 0x0000, 0x3333, 0x6666,  0, 0 },
+    { 208, 0x0000, 0x3333, 0x3333,  0, 0 },
+    { 209, 0x0000, 0x3333, 0x0000,  0, 0 },
+    { 210, 0x0000, 0x0000, 0xffff,  0, 0 },
+    { 211, 0x0000, 0x0000, 0xcccc,  0, 0 },
+    { 212, 0x0000, 0x0000, 0x9999,  0, 0 },
+    { 213, 0x0000, 0x0000, 0x6666,  0, 0 },
+    { 214, 0x0000, 0x0000, 0x3333,  0, 0 },
+    { 215, 0xeeee, 0x0000, 0x0000,  0, 0 },
+    { 216, 0xdddd, 0x0000, 0x0000,  0, 0 },
+    { 217, 0xbbbb, 0x0000, 0x0000,  0, 0 },
+    { 218, 0xaaaa, 0x0000, 0x0000,  0, 0 },
+    { 219, 0x8888, 0x0000, 0x0000,  0, 0 },
+    { 220, 0x7777, 0x0000, 0x0000,  0, 0 },
+    { 221, 0x5555, 0x0000, 0x0000,  0, 0 },
+    { 222, 0x4444, 0x0000, 0x0000,  0, 0 },
+    { 223, 0x2222, 0x0000, 0x0000,  0, 0 },
+    { 224, 0x1111, 0x0000, 0x0000,  0, 0 },
+    { 225, 0x0000, 0xeeee, 0x0000,  0, 0 },
+    { 226, 0x0000, 0xdddd, 0x0000,  0, 0 },
+    { 227, 0x0000, 0xbbbb, 0x0000,  0, 0 },
+    { 228, 0x0000, 0xaaaa, 0x0000,  0, 0 },
+    { 229, 0x0000, 0x8888, 0x0000,  0, 0 },
+    { 230, 0x0000, 0x7777, 0x0000,  0, 0 },
+    { 231, 0x0000, 0x5555, 0x0000,  0, 0 },
+    { 232, 0x0000, 0x4444, 0x0000,  0, 0 },
+    { 233, 0x0000, 0x2222, 0x0000,  0, 0 },
+    { 234, 0x0000, 0x1111, 0x0000,  0, 0 },
+    { 235, 0x0000, 0x0000, 0xeeee,  0, 0 },
+    { 236, 0x0000, 0x0000, 0xdddd,  0, 0 },
+    { 237, 0x0000, 0x0000, 0xbbbb,  0, 0 },
+    { 238, 0x0000, 0x0000, 0xaaaa,  0, 0 },
+    { 239, 0x0000, 0x0000, 0x8888,  0, 0 },
+    { 240, 0x0000, 0x0000, 0x7777,  0, 0 },
+    { 241, 0x0000, 0x0000, 0x5555,  0, 0 },
+    { 242, 0x0000, 0x0000, 0x4444,  0, 0 },
+    { 243, 0x0000, 0x0000, 0x2222,  0, 0 },
+    { 244, 0x0000, 0x0000, 0x1111,  0, 0 },
+    { 245, 0xeeee, 0xeeee, 0xeeee,  0, 0 },
+    { 246, 0xdddd, 0xdddd, 0xdddd,  0, 0 },
+    { 247, 0xbbbb, 0xbbbb, 0xbbbb,  0, 0 },
+    { 248, 0xaaaa, 0xaaaa, 0xaaaa,  0, 0 },
+    { 249, 0x8888, 0x8888, 0x8888,  0, 0 },
+    { 250, 0x7777, 0x7777, 0x7777,  0, 0 },
+    { 251, 0x5555, 0x5555, 0x5555,  0, 0 },
+    { 252, 0x4444, 0x4444, 0x4444,  0, 0 },
+    { 253, 0x2222, 0x2222, 0x2222,  0, 0 },
+    { 254, 0x1111, 0x1111, 0x1111,  0, 0 },
+    { 255, 0xffff, 0xffff, 0xffff,  0, 0 }
+};
+#endif /* USE_NEW_CLUT */
+
+#endif /* _DARWIN_CLUT8_ */
Index: xc/programs/Xserver/hw/darwin/quartz/XDarwin.pbproj/project.pbxproj
diff -u xc/programs/Xserver/hw/darwin/quartz/XDarwin.pbproj/project.pbxproj:1.11 xc/programs/Xserver/hw/darwin/quartz/XDarwin.pbproj/project.pbxproj:1.11.2.1
--- xc/programs/Xserver/hw/darwin/quartz/XDarwin.pbproj/project.pbxproj:1.11	Tue Jan 28 20:11:06 2003
+++ xc/programs/Xserver/hw/darwin/quartz/XDarwin.pbproj/project.pbxproj	Thu Feb 27 20:36:09 2003
@@ -371,7 +371,7 @@
 	<key>CFBundleExecutable</key>
 	<string>XDarwin</string>
 	<key>CFBundleGetInfoString</key>
-	<string>XDarwin 1.2b4, 2001-2003 XFree86 Project, Inc.</string>
+	<string>XDarwin 1.2.0, 2001-2003 XFree86 Project, Inc.</string>
 	<key>CFBundleIconFile</key>
 	<string>XDarwin.icns</string>
 	<key>CFBundleIdentifier</key>
@@ -383,7 +383,7 @@
 	<key>CFBundlePackageType</key>
 	<string>APPL</string>
 	<key>CFBundleShortVersionString</key>
-	<string>XDarwin 1.2b4</string>
+	<string>XDarwin 1.2.0</string>
 	<key>CFBundleSignature</key>
 	<string>????</string>
 	<key>CFBundleVersion</key>
Index: xc/programs/Xserver/hw/xfree86/CHANGELOG
diff -u xc/programs/Xserver/hw/xfree86/CHANGELOG:3.2588 xc/programs/Xserver/hw/xfree86/CHANGELOG:3.2588.2.13
--- xc/programs/Xserver/hw/xfree86/CHANGELOG:3.2588	Wed Feb 26 23:56:44 2003
+++ xc/programs/Xserver/hw/xfree86/CHANGELOG	Fri May  9 21:12:56 2003
@@ -1,3 +1,47 @@
+XFree86 4.3.0.2 (xx May 2003)
+
+XFree86 4.3.0.1 (9 May 2003)
+ 987. Fix a FreeBSD/alpha build problem (#5679, Fred Clift).
+ 986. Fix SiliconMotion driver for mode switching and SEGV problem when
+      initializing Xv functionality (Bugzilla #50, Alan Hourihane).
+ 985. Fix a SEGV that can happen with Riva128 cards (Mark Vojkovich).
+ 984. Prevent a SIGFPE with the glint/pm3 driver when attempting to display
+      an XVideo image less than 8 pixels wide (Mns Rullgrd).
+ 983. Fix double free bug when a Mac-specific font fails to load with
+      Freetype (Torrey T. Lyons).
+ 982. Check for NULL tObj in the i830 3D driver's TexEnv function.  This
+      fixes a FlightGear crash (Keith Whitwell).
+ 981. Fix lockup on server reset in radeon driver
+      (Michel Dnzer, Keith Whitwell).
+ 980. Set Mesa hooks to flush vertices on state changes in Radeon 3D drivers
+      (Keith Whitwell).
+ 979. Fix to prevent PCI and CardBus resets when switching out of the server's
+      virtual console (Marc La France).
+ 978. Fix infinite loop that occurs on systems whose PCI configuration space
+      doesn't advertise a host bridge (Marc La France).
+ 977. Workaround for broken devices that don't implement the header type field
+      in their PCI configuration space (Marc La France).
+ 976. Fix programming error in ix86 motherboard chipset determination
+      (Marc La France).
+ 975. Fix bug in mode validation that occurs when the XF86Config doesn't
+      specify any mode or virtual resolution information (Marc La France).
+ 974. Another int10 fix.  This time for adapters found at PCI:0:0:0.  This
+      fix is particularly important for ZX1-based systems (Marc La France).
+ 973. int10 fix for all ix86 non-Linux systems (Marc La France).
+ 972. Fix compatibility problem between modules generated without the recent
+      setjmp/longjmp work and a server generated using glibc <= 2.2.*
+      (Marc La France).
+ 971. setjmp/longjmp related fixes for Linux/libc5 systems (Marc La France).
+ 970. Make setjmp/longjmp emulation save/restore blocked signal masks on all
+      libc5 & glibc systems (Marc La France).
+ 969. Fix setjmp/longjmp emulation for glibc 2.2.[01] systems and remove
+      HasGlibc21Sigsetjmp override (Marc La France).
+ 968. setjmp/longjmp-related compilation fixes for libc5 systems
+      (Marc La France).
+ 967. Fix possible overflow in _XlcLocaleDirName. (Matthieu Herrb).
+ 966. Fix XDarwin build broken by #960 (Shantonu Sen).
+ 965. Fix StaticColor colormap on Darwin/x86 6.x (Rob Braun).
+
 XFree86 4.3.0 (27 February 2003)
  964. Add an imake option to allow the glibc21-style setjmp() behaviour
       to be forced when auto-detecting it fails (this is needed for RH 7.0).
@@ -16536,4 +16580,9 @@
 XFree86 3.0 (26 April 1994)
 
 
-$XFree86: xc/programs/Xserver/hw/xfree86/CHANGELOG,v 3.2588 2003/02/27 04:56:44 dawes Exp $
+$XFree86: xc/programs/Xserver/hw/xfree86/CHANGELOG,v 3.2588.2.13 2003/05/10 01:12:56 dawes Exp $
+
+
+
+
+
Index: xc/programs/Xserver/hw/xfree86/xf86Date.h
diff -u xc/programs/Xserver/hw/xfree86/xf86Date.h:1.3 xc/programs/Xserver/hw/xfree86/xf86Date.h:1.3.2.3
--- xc/programs/Xserver/hw/xfree86/xf86Date.h:1.3	Wed Feb 26 23:56:45 2003
+++ xc/programs/Xserver/hw/xfree86/xf86Date.h	Fri May  9 21:10:10 2003
@@ -1,7 +1,7 @@
-/* $XFree86: xc/programs/Xserver/hw/xfree86/xf86Date.h,v 1.3 2003/02/27 04:56:45 dawes Exp $ */
+/* $XFree86: xc/programs/Xserver/hw/xfree86/xf86Date.h,v 1.3.2.3 2003/05/10 01:10:10 dawes Exp $ */
 
 #ifndef XF86_DATE
 
-#define XF86_DATE	"27 February 2003"
+#define XF86_DATE	"9 May 2003"
 
 #endif
Index: xc/programs/Xserver/hw/xfree86/xf86Version.h
diff -u xc/programs/Xserver/hw/xfree86/xf86Version.h:3.543 xc/programs/Xserver/hw/xfree86/xf86Version.h:3.543.2.1
--- xc/programs/Xserver/hw/xfree86/xf86Version.h:3.543	Wed Feb 26 23:56:45 2003
+++ xc/programs/Xserver/hw/xfree86/xf86Version.h	Fri May  9 21:10:10 2003
@@ -1,11 +1,11 @@
-/* $XFree86: xc/programs/Xserver/hw/xfree86/xf86Version.h,v 3.543 2003/02/27 04:56:45 dawes Exp $ */
+/* $XFree86: xc/programs/Xserver/hw/xfree86/xf86Version.h,v 3.543.2.1 2003/05/10 01:10:10 dawes Exp $ */
 
 #ifndef XF86_VERSION_CURRENT
 
 #define XF86_VERSION_MAJOR	4
 #define XF86_VERSION_MINOR	3
 #define XF86_VERSION_PATCH	0
-#define XF86_VERSION_SNAP	0
+#define XF86_VERSION_SNAP	1
 
 /* This has five arguments for compatibilty reasons */
 #define XF86_VERSION_NUMERIC(major,minor,patch,snap,dummy) \
Index: xc/programs/Xserver/hw/xfree86/common/xf86Mode.c
diff -u xc/programs/Xserver/hw/xfree86/common/xf86Mode.c:1.63 xc/programs/Xserver/hw/xfree86/common/xf86Mode.c:1.63.2.1
--- xc/programs/Xserver/hw/xfree86/common/xf86Mode.c:1.63	Wed Jan 22 16:44:09 2003
+++ xc/programs/Xserver/hw/xfree86/common/xf86Mode.c	Tue Apr  8 16:51:27 2003
@@ -1,4 +1,4 @@
-/* $XFree86: xc/programs/Xserver/hw/xfree86/common/xf86Mode.c,v 1.63 2003/01/22 21:44:09 tsi Exp $ */
+/* $XFree86: xc/programs/Xserver/hw/xfree86/common/xf86Mode.c,v 1.63.2.1 2003/04/08 20:51:27 tsi Exp $ */
 
 /*
  * Copyright (c) 1997,1998 by The XFree86 Project, Inc.
@@ -1639,7 +1639,7 @@
 	/*
 	 * Don't let non-user defined modes increase the virtual size
 	 */
-	if (!(p->type & M_T_USERDEF)) {
+	if (!(p->type & M_T_USERDEF) && (numModes > 0)) {
 	    if (p->HDisplay > virtX) {
 		p->status = MODE_VIRTUAL_X;
 		goto lookupNext;
@@ -1732,16 +1732,17 @@
     scrp->virtualX = virtX;
     scrp->virtualY = virtY;
     scrp->displayWidth = linePitch;
+
+    if (numModes <= 0)
+	return 0;
     
     /* Make the mode list into a circular list by joining up the ends */
-    if (numModes > 0) {
-	p = scrp->modes;
-	while (p->next != NULL)
-	    p = p->next;
-	/* p is now the last mode on the list */
-	p->next = scrp->modes;
-	scrp->modes->prev = p;
-    }
+    p = scrp->modes;
+    while (p->next != NULL)
+	p = p->next;
+    /* p is now the last mode on the list */
+    p->next = scrp->modes;
+    scrp->modes->prev = p;
 
     if (minHeight > 0 && virtY < minHeight) {
 	xf86DrvMsg(scrp->scrnIndex, X_ERROR,
Index: xc/programs/Xserver/hw/xfree86/common/xf86pciBus.c
diff -u xc/programs/Xserver/hw/xfree86/common/xf86pciBus.c:3.68 xc/programs/Xserver/hw/xfree86/common/xf86pciBus.c:3.68.2.1
--- xc/programs/Xserver/hw/xfree86/common/xf86pciBus.c:3.68	Tue Feb 18 10:42:11 2003
+++ xc/programs/Xserver/hw/xfree86/common/xf86pciBus.c	Tue May  6 13:00:43 2003
@@ -1,4 +1,4 @@
-/* $XFree86: xc/programs/Xserver/hw/xfree86/common/xf86pciBus.c,v 3.68 2003/02/18 15:42:11 tsi Exp $ */
+/* $XFree86: xc/programs/Xserver/hw/xfree86/common/xf86pciBus.c,v 3.68.2.1 2003/05/06 17:00:43 tsi Exp $ */
 /*
  * Copyright (c) 1997-2002 by The XFree86 Project, Inc.
  */
@@ -741,7 +741,8 @@
 savePciBusState(BusAccPtr ptr)
 {
     ptr->busdep.pci.save.control =
-	pciReadWord(ptr->busdep.pci.acc, PCI_PCI_BRIDGE_CONTROL_REG);
+	pciReadWord(ptr->busdep.pci.acc, PCI_PCI_BRIDGE_CONTROL_REG) &
+	~PCI_PCI_BRIDGE_SECONDARY_RESET;
     /* Allow master aborts to complete normally on non-root buses */
     if (ptr->busdep.pci.save.control & PCI_PCI_BRIDGE_MASTER_ABORT_EN)
 	pciWriteWord(ptr->busdep.pci.acc, PCI_PCI_BRIDGE_CONTROL_REG,
@@ -2164,8 +2165,7 @@
 		}
 		*pnPciBus = PciBus = xnfcalloc(1, sizeof(PciBusRec));
 		pnPciBus = &PciBus->next;
-		PciBus->primary = -1;
-		PciBus->secondary = i;
+		PciBus->primary = PciBus->secondary = i;
 		PciBus->subclass = PCI_SUBCLASS_BRIDGE_HOST;
 		PciBus->brcontrol = PCI_PCI_BRIDGE_VGA_EN;
 		PciBus->preferred_io =
Index: xc/programs/Xserver/hw/xfree86/drivers/ati/radeon_dri.c
diff -u xc/programs/Xserver/hw/xfree86/drivers/ati/radeon_dri.c:1.32 xc/programs/Xserver/hw/xfree86/drivers/ati/radeon_dri.c:1.32.2.1
--- xc/programs/Xserver/hw/xfree86/drivers/ati/radeon_dri.c:1.32	Wed Feb 19 04:17:30 2003
+++ xc/programs/Xserver/hw/xfree86/drivers/ati/radeon_dri.c	Tue May  6 19:21:38 2003
@@ -1,4 +1,4 @@
-/* $XFree86: xc/programs/Xserver/hw/xfree86/drivers/ati/radeon_dri.c,v 1.32 2003/02/19 09:17:30 alanh Exp $ */
+/* $XFree86: xc/programs/Xserver/hw/xfree86/drivers/ati/radeon_dri.c,v 1.32.2.1 2003/05/06 23:21:38 daenzer Exp $ */
 /*
  * Copyright 2000 ATI Technologies Inc., Markham, Ontario,
  *                VA Linux Systems Inc., Fremont, California.
@@ -1585,6 +1585,7 @@
     if (info->irq) {
 	drmCtlUninstHandler(info->drmFD);
 	info->irq = 0;
+	info->ModeReg.gen_int_cntl = 0;
     }
 
 				/* De-allocate vertex buffers */
Index: xc/programs/Xserver/hw/xfree86/drivers/ati/radeon_reg.h
diff -u xc/programs/Xserver/hw/xfree86/drivers/ati/radeon_reg.h:1.25 xc/programs/Xserver/hw/xfree86/drivers/ati/radeon_reg.h:1.25.2.1
--- xc/programs/Xserver/hw/xfree86/drivers/ati/radeon_reg.h:1.25	Fri Feb  7 13:08:59 2003
+++ xc/programs/Xserver/hw/xfree86/drivers/ati/radeon_reg.h	Fri Mar  7 07:13:59 2003
@@ -1,4 +1,4 @@
-/* $XFree86: xc/programs/Xserver/hw/xfree86/drivers/ati/radeon_reg.h,v 1.25 2003/02/07 18:08:59 martin Exp $ */
+/* $XFree86: xc/programs/Xserver/hw/xfree86/drivers/ati/radeon_reg.h,v 1.25.2.1 2003/03/07 12:13:59 alanh Exp $ */
 /*
  * Copyright 2000 ATI Technologies Inc., Markham, Ontario, and
  *                VA Linux Systems Inc., Fremont, California.
@@ -879,7 +879,7 @@
 #       define RADEON_P2PLL_REF_DIV_MASK    0x03ff
 #       define RADEON_P2PLL_ATOMIC_UPDATE_R (1 << 15) /* same as _W */
 #       define RADEON_P2PLL_ATOMIC_UPDATE_W (1 << 15) /* same as _R */
-#       define R300_PPLL_REF_DIV_ACC_MASK   (0x3ff < 18)
+#       define R300_PPLL_REF_DIV_ACC_MASK   (0x3ff << 18)
 #       define R300_PPLL_REF_DIV_ACC_SHIFT  18
 #define RADEON_PALETTE_DATA                 0x00b4
 #define RADEON_PALETTE_30_DATA              0x00b8
Index: xc/programs/Xserver/hw/xfree86/drivers/glint/pm3_video.c
diff -u xc/programs/Xserver/hw/xfree86/drivers/glint/pm3_video.c:1.11 xc/programs/Xserver/hw/xfree86/drivers/glint/pm3_video.c:1.11.2.1
--- xc/programs/Xserver/hw/xfree86/drivers/glint/pm3_video.c:1.11	Wed May 22 04:12:02 2002
+++ xc/programs/Xserver/hw/xfree86/drivers/glint/pm3_video.c	Thu May  8 22:10:18 2003
@@ -22,7 +22,7 @@
  * Authors: Alan Hourihane, alanh@fairlite.demon.co.uk
  *          Sven Luther <luther@dpt-info.u-strasbg.fr>
  */
-/* $XFree86: xc/programs/Xserver/hw/xfree86/drivers/glint/pm3_video.c,v 1.11 2002/05/22 08:12:02 alanh Exp $ */
+/* $XFree86: xc/programs/Xserver/hw/xfree86/drivers/glint/pm3_video.c,v 1.11.2.1 2003/05/09 02:10:18 dawes Exp $ */
 
 #include "xf86.h"
 #include "xf86_OSproc.h"
@@ -745,6 +745,10 @@
 	x2 = drw_w - (dstBox->x2 - dstBox->x1);
 	drw_w = (dstBox->x2 - dstBox->x1);
     }
+
+    /* Avoid divide by zero in compute_scale_factor. */
+    if (drw_w < 8)
+	return;
 
     /* Let's adjust the width of source and dest to be compliant with 
      * the Permedia3 overlay unit requirement, and compute the X deltas. */
Index: xc/programs/Xserver/hw/xfree86/drivers/nv/nv_setup.c
diff -u xc/programs/Xserver/hw/xfree86/drivers/nv/nv_setup.c:1.27 xc/programs/Xserver/hw/xfree86/drivers/nv/nv_setup.c:1.27.2.1
--- xc/programs/Xserver/hw/xfree86/drivers/nv/nv_setup.c:1.27	Mon Feb 10 18:42:51 2003
+++ xc/programs/Xserver/hw/xfree86/drivers/nv/nv_setup.c	Thu May  8 22:17:49 2003
@@ -24,7 +24,7 @@
 /* Hacked together from mga driver and 3.3.4 NVIDIA driver by Jarno Paananen
    <jpaana@s2.org> */
 
-/* $XFree86: xc/programs/Xserver/hw/xfree86/drivers/nv/nv_setup.c,v 1.27 2003/02/10 23:42:51 mvojkovi Exp $ */
+/* $XFree86: xc/programs/Xserver/hw/xfree86/drivers/nv/nv_setup.c,v 1.27.2.1 2003/05/09 02:17:49 dawes Exp $ */
 
 #include "nv_include.h"
 
@@ -416,6 +416,9 @@
         break;
     }
 
+    if(pNv->riva.Architecture == 3)
+       pNv->riva.PCRTC0 = pNv->riva.PGRAPH;
+
     if(pNv->SecondCRTC) {
        pNv->riva.PCIO = pNv->riva.PCIO0 + 0x2000;
        pNv->riva.PCRTC = pNv->riva.PCRTC0 + 0x800;
@@ -484,7 +487,6 @@
                                      frameBase+0x00C00000, 0x00008000);
             
     NVCommonSetup(pScrn);
-    pNv->riva.PCRTC = pNv->riva.PCRTC0 = pNv->riva.PGRAPH;
 }
 
 void
Index: xc/programs/Xserver/hw/xfree86/drivers/siliconmotion/smi_driver.c
diff -u xc/programs/Xserver/hw/xfree86/drivers/siliconmotion/smi_driver.c:1.28 xc/programs/Xserver/hw/xfree86/drivers/siliconmotion/smi_driver.c:1.28.2.1
--- xc/programs/Xserver/hw/xfree86/drivers/siliconmotion/smi_driver.c:1.28	Wed Feb  5 12:45:29 2003
+++ xc/programs/Xserver/hw/xfree86/drivers/siliconmotion/smi_driver.c	Thu May  8 22:22:00 2003
@@ -26,7 +26,7 @@
 sale, use or other dealings in this Software without prior written
 authorization from The XFree86 Project or Silicon Motion.
 */
-/* $XFree86: xc/programs/Xserver/hw/xfree86/drivers/siliconmotion/smi_driver.c,v 1.28 2003/02/05 17:45:29 eich Exp $ */
+/* $XFree86: xc/programs/Xserver/hw/xfree86/drivers/siliconmotion/smi_driver.c,v 1.28.2.1 2003/05/09 02:22:00 dawes Exp $ */
 
 #include "xf86Resources.h"
 #include "xf86RAC.h"
@@ -1410,7 +1410,7 @@
 	ENTER_PROC("SMI_Save");
 
 	/* Save the standard VGA registers */
-	vgaHWSave(pScrn, vgaSavePtr, VGA_SR_MODE);
+	vgaHWSave(pScrn, vgaSavePtr, VGA_SR_ALL);
 	save->smiDACMask = VGAIN8(pSmi, VGA_DAC_MASK);
 	VGAOUT8(pSmi, VGA_DAC_READ_ADDR, 0);
 	for (i = 0; i < 256; i++)
@@ -1601,7 +1601,7 @@
 		VGAOUT8_INDEX(pSmi, VGA_SEQ_INDEX, VGA_SEQ_DATA, 0xA0, restore->SRA0);
 
 		/* Restore the standard VGA registers */
-		vgaHWRestore(pScrn, vgaSavePtr, VGA_SR_MODE);
+		vgaHWRestore(pScrn, vgaSavePtr, VGA_SR_ALL);
 		if (restore->smiDACMask)
 		{
 			VGAOUT8(pSmi, VGA_DAC_MASK, restore->smiDACMask);
@@ -1672,7 +1672,7 @@
 		} 
 
 		if (restore->modeInit)
-		    vgaHWRestore(pScrn, vgaSavePtr, VGA_SR_MODE);
+		    vgaHWRestore(pScrn, vgaSavePtr, VGA_SR_ALL);
 
 		if (!SMI_LYNXM_SERIES(pSmi->Chipset))
 		{
Index: xc/programs/Xserver/hw/xfree86/drivers/siliconmotion/smi_video.c
diff -u xc/programs/Xserver/hw/xfree86/drivers/siliconmotion/smi_video.c:1.9 xc/programs/Xserver/hw/xfree86/drivers/siliconmotion/smi_video.c:1.9.2.1
--- xc/programs/Xserver/hw/xfree86/drivers/siliconmotion/smi_video.c:1.9	Sat Jan 11 22:55:49 2003
+++ xc/programs/Xserver/hw/xfree86/drivers/siliconmotion/smi_video.c	Thu May  8 22:22:00 2003
@@ -41,7 +41,7 @@
 Date:   2.11.2001
 */
 
-/* $XFree86: xc/programs/Xserver/hw/xfree86/drivers/siliconmotion/smi_video.c,v 1.9 2003/01/12 03:55:49 tsi Exp $ */
+/* $XFree86: xc/programs/Xserver/hw/xfree86/drivers/siliconmotion/smi_video.c,v 1.9.2.1 2003/05/09 02:22:00 dawes Exp $ */
 
 #include "smi.h"
 #include "smi_video.h"
@@ -277,7 +277,7 @@
     {XvSettable | XvGettable,        0,             1, XV_INTERLACED_NAME},
 };
 
-static XF86AttributeRec SMI_VideoAttributes[N_ATTRS] = {
+static XF86AttributeRec SMI_VideoAttributes[2] = {
     {XvSettable | XvGettable,        0,           255, XV_BRIGHTNESS_NAME},
     {XvSettable | XvGettable, 0x000000,      0xFFFFFF, XV_COLORKEY_NAME},
 };
Index: xc/programs/Xserver/hw/xfree86/etc/Xinstall.sh
diff -u xc/programs/Xserver/hw/xfree86/etc/Xinstall.sh:1.48 xc/programs/Xserver/hw/xfree86/etc/Xinstall.sh:1.48.2.3
--- xc/programs/Xserver/hw/xfree86/etc/Xinstall.sh:1.48	Sun Feb 23 23:24:17 2003
+++ xc/programs/Xserver/hw/xfree86/etc/Xinstall.sh	Sat Mar  8 08:46:26 2003
@@ -1,7 +1,7 @@
 #!/bin/sh
 
 #
-# $XFree86: xc/programs/Xserver/hw/xfree86/etc/Xinstall.sh,v 1.48 2003/02/24 04:24:17 dawes Exp $
+# $XFree86: xc/programs/Xserver/hw/xfree86/etc/Xinstall.sh,v 1.48.2.3 2003/03/08 13:46:26 dawes Exp $
 #
 # Copyright  2000 by Precision Insight, Inc.
 # Copyright  2000, 2001 by VA Linux Systems, Inc.
@@ -561,8 +561,11 @@
 				2)
 					DistName="Linux-ix86-glibc22"
 					;;
+				3)
+					DistName="Linux-ix86-glibc23"
+					;;
 				*)
-					Message="No dist available for glibc 2.$OsLibcMinor.  Try Linux-ix86-glibc22"
+					Message="No dist available for glibc 2.$OsLibcMinor.  Try Linux-ix86-glibc23"
 					;;
 				esac
 				;;
@@ -596,8 +599,11 @@
 			6.1)
 				DistName="Linux-alpha-glibc21"
 				;;
+			6.2)
+				DistName="Linux-alpha-glibc22"
+				;;
 			6.*)
-				Message="No Linux/alpha binaries for glibc 2.$OsLibcMinor.  Try Linux-alpha-glibc21"
+				Message="No Linux/alpha binaries for glibc 2.$OsLibcMinor.  Try Linux-alpha-glibc22"
 				;;
 			*)
 				Message="No Linux/alpha binaries for this libc version"
@@ -632,7 +638,7 @@
 					DistName="NetBSD-1.4.x"
 					;;
 				*)
-					DistName="NetBSD-1.5"
+					DistName="NetBSD-1.6"
 					;;
 				esac
 				;;
@@ -650,8 +656,8 @@
 		case "$OsArch" in
 		i386)
 			case "$OsVersion" in
-			3.0*)	# Check this
-				DistName="OpenBSD-3.0"
+			3.2*)	# Check this
+				DistName="OpenBSD-3.2"
 				;;
 			*)
 				Message="No OpenBSD/i386 binaries available for this version"
@@ -947,7 +953,7 @@
             SERVDIST="Xxserv.tgz"
         fi
 	;;
-FreeBSD|NetBSD|OpenBSD)
+FreeBSD|OpenBSD)
 	VARDIST="Xvar.tgz"
 	XKBDBDIR="$VARDIR/db/xkb"
 	;;
Index: xc/programs/Xserver/hw/xfree86/int10/generic.c
diff -u xc/programs/Xserver/hw/xfree86/int10/generic.c:1.25 xc/programs/Xserver/hw/xfree86/int10/generic.c:1.25.2.1
--- xc/programs/Xserver/hw/xfree86/int10/generic.c:1.25	Thu Apr  4 09:05:51 2002
+++ xc/programs/Xserver/hw/xfree86/int10/generic.c	Thu Mar 20 10:14:25 2003
@@ -1,4 +1,4 @@
-/* $XFree86: xc/programs/Xserver/hw/xfree86/int10/generic.c,v 1.25 2002/04/04 14:05:51 eich Exp $ */
+/* $XFree86: xc/programs/Xserver/hw/xfree86/int10/generic.c,v 1.25.2.1 2003/03/20 15:14:25 tsi Exp $ */
 /*
  *                   XFree86 int10 module
  *   execute BIOS int 10h calls in x86 real mode environment
@@ -108,7 +108,7 @@
     MapVRam(pInt);
 #ifdef _PC
     if (!sysMem)
-	sysMem = xf86MapVidMem(screen, VIDMEM_FRAMEBUFFER, V_BIOS,
+	sysMem = xf86MapVidMem(screen, VIDMEM_MMIO, V_BIOS,
 			       BIOS_SIZE + SYS_BIOS - V_BIOS);
     INTPriv(pInt)->sysMem = sysMem;
 
@@ -446,12 +446,14 @@
 #define OFF(addr) ((addr) & 0xffff)
 #if defined _PC
 # define HIGH_OFFSET (INTPriv(pInt)->highMemory)
+# define HIGH_BASE   V_BIOS
 #else
 # define HIGH_OFFSET SYS_BIOS
+# define HIGH_BASE   SYS_BIOS
 #endif
 # define SYS(addr) ((addr) >= HIGH_OFFSET)
 #define V_ADDR(addr) \
-	  (SYS(addr) ? ((char*)INTPriv(pInt)->sysMem) + (addr - HIGH_OFFSET) \
+	  (SYS(addr) ? ((char*)INTPriv(pInt)->sysMem) + (addr - HIGH_BASE) \
 	   : (((char*)(INTPriv(pInt)->base) + addr)))
 #define VRAM_ADDR(addr) (addr - V_RAM)
 #define VRAM_BASE (INTPriv(pInt)->vRam)
Index: xc/programs/Xserver/hw/xfree86/int10/xf86int10.c
diff -u xc/programs/Xserver/hw/xfree86/int10/xf86int10.c:1.10 xc/programs/Xserver/hw/xfree86/int10/xf86int10.c:1.10.2.1
--- xc/programs/Xserver/hw/xfree86/int10/xf86int10.c:1.10	Mon Nov 25 09:05:01 2002
+++ xc/programs/Xserver/hw/xfree86/int10/xf86int10.c	Fri Mar 21 17:29:59 2003
@@ -1,4 +1,4 @@
-/* $XFree86: xc/programs/Xserver/hw/xfree86/int10/xf86int10.c,v 1.10 2002/11/25 14:05:01 eich Exp $ */
+/* $XFree86: xc/programs/Xserver/hw/xfree86/int10/xf86int10.c,v 1.10.2.1 2003/03/21 22:29:59 tsi Exp $ */
 /*
  *                   XFree86 int10 module
  *   execute BIOS int 10h calls in x86 real mode environment
@@ -664,7 +664,7 @@
 #endif
 	return 1;
     case 0xb108:
-	if ((tag = findPci(pInt, X86_EBX))) {
+	if ((tag = findPci(pInt, X86_EBX)) != PCI_NOT_FOUND) {
 	    X86_CL = pciReadByte(tag, X86_EDI);
 	    X86_EAX = X86_AL | (SUCCESSFUL << 8);
 	    X86_EFLAGS &= ~((unsigned long)0x01); /* clear carry flag */
@@ -677,7 +677,7 @@
 #endif
 	return 1;
     case 0xb109:
-	if ((tag = findPci(pInt, X86_EBX))) {
+	if ((tag = findPci(pInt, X86_EBX)) != PCI_NOT_FOUND) {
 	    X86_CX = pciReadWord(tag, X86_EDI);
 	    X86_EAX = X86_AL | (SUCCESSFUL << 8);
 	    X86_EFLAGS &= ~((unsigned long)0x01); /* clear carry flag */
@@ -690,7 +690,7 @@
 #endif
 	return 1;
     case 0xb10a:
-	if ((tag = findPci(pInt, X86_EBX))) {
+	if ((tag = findPci(pInt, X86_EBX)) != PCI_NOT_FOUND) {
 	    X86_ECX = pciReadLong(tag, X86_EDI);
 	    X86_EAX = X86_AL | (SUCCESSFUL << 8);
 	    X86_EFLAGS &= ~((unsigned long)0x01); /* clear carry flag */
@@ -703,7 +703,7 @@
 #endif
 	return 1;
     case 0xb10b:
-	if ((tag = findPci(pInt, X86_EBX))) {
+	if ((tag = findPci(pInt, X86_EBX)) != PCI_NOT_FOUND) {
 	    pciWriteByte(tag, X86_EDI, X86_CL);
 	    X86_EAX = X86_AL | (SUCCESSFUL << 8);
 	    X86_EFLAGS &= ~((unsigned long)0x01); /* clear carry flag */
@@ -716,7 +716,7 @@
 #endif
 	return 1;
     case 0xb10c:
-	if ((tag = findPci(pInt, X86_EBX))) {
+	if ((tag = findPci(pInt, X86_EBX)) != PCI_NOT_FOUND) {
 	    pciWriteWord(tag, X86_EDI, X86_CX);
 	    X86_EAX = X86_AL | (SUCCESSFUL << 8);
 	    X86_EFLAGS &= ~((unsigned long)0x01); /* clear carry flag */
@@ -729,7 +729,7 @@
 #endif
 	return 1;
     case 0xb10d:
-	if ((tag = findPci(pInt, X86_EBX))) {
+	if ((tag = findPci(pInt, X86_EBX)) != PCI_NOT_FOUND) {
 	    pciWriteLong(tag, X86_EDI, X86_ECX);
 	    X86_EAX = X86_AL | (SUCCESSFUL << 8);
 	    X86_EFLAGS &= ~((unsigned long)0x01); /* clear carry flag */
@@ -759,7 +759,7 @@
     int func = bx & 0x7;
     if (xf86IsPciDevPresent(bus, dev, func))
 	return pciTag(bus, dev, func);
-    return 0;
+    return PCI_NOT_FOUND;
 }
 
 static CARD32
Index: xc/programs/Xserver/hw/xfree86/loader/Imakefile
diff -u xc/programs/Xserver/hw/xfree86/loader/Imakefile:1.35 xc/programs/Xserver/hw/xfree86/loader/Imakefile:1.35.2.1
--- xc/programs/Xserver/hw/xfree86/loader/Imakefile:1.35	Wed Feb 26 18:32:12 2003
+++ xc/programs/Xserver/hw/xfree86/loader/Imakefile	Wed Mar 12 23:10:47 2003
@@ -1,4 +1,4 @@
-XCOMM $XFree86: xc/programs/Xserver/hw/xfree86/loader/Imakefile,v 1.35 2003/02/26 23:32:12 dawes Exp $ */
+XCOMM $XFree86: xc/programs/Xserver/hw/xfree86/loader/Imakefile,v 1.35.2.1 2003/03/13 04:10:47 tsi Exp $ */
 
 
 
@@ -30,10 +30,6 @@
     SHM_DEFINES = -DHAS_SHM
 #endif
 
-#if HasGlibc21Sigsetjmp
-  SETJMPDEFINES = -DHAS_GLIBC_SIGSETJMP=1
-#endif
-
 #if defined (x86_64Architecture)
 ARCHDEFINES = -DDoMMAPedMerge -DMmapPageAlign
 #endif
@@ -77,7 +73,7 @@
 NormalLibraryTarget(xloader,$(XOBJS) )
 
 SpecialCObjectRule(loadmod,NullParameter,$(MODULEDEFINES) $(EXT_DEFINES))
-SpecialCObjectRule(xf86sym,NullParameter,$(EXT_DEFINES) $(SETJMPDEFINES))
+SpecialCObjectRule(xf86sym,NullParameter,$(EXT_DEFINES))
 SpecialCObjectRule(dixsym,NullParameter,$(EXT_DEFINES))
 
 #ifdef SparcArchitecture
Index: xc/programs/Xserver/hw/xfree86/loader/xf86sym.c
diff -u xc/programs/Xserver/hw/xfree86/loader/xf86sym.c:1.227 xc/programs/Xserver/hw/xfree86/loader/xf86sym.c:1.227.2.1
--- xc/programs/Xserver/hw/xfree86/loader/xf86sym.c:1.227	Wed Feb 26 15:08:02 2003
+++ xc/programs/Xserver/hw/xfree86/loader/xf86sym.c	Wed Mar 12 23:10:47 2003
@@ -1,4 +1,4 @@
-/* $XFree86: xc/programs/Xserver/hw/xfree86/loader/xf86sym.c,v 1.227 2003/02/26 20:08:02 dawes Exp $ */
+/* $XFree86: xc/programs/Xserver/hw/xfree86/loader/xf86sym.c,v 1.227.2.1 2003/03/13 04:10:47 tsi Exp $ */
 
 /*
  *
@@ -63,8 +63,9 @@
 #include "compiler.h"
 
 #ifndef HAS_GLIBC_SIGSETJMP
-#if defined(setjmp) && \
-    defined(__GLIBC__) && __GLIBC__ == 2 && __GLIBC_MINOR__ < 2
+#if defined(setjmp) && defined(__GNU_LIBRARY__) && \
+    (!defined(__GLIBC__) || (__GLIBC__ < 2) || \
+     ((__GLIBC__ == 2) && (__GLIBC_MINOR__ < 3)))
 #define HAS_GLIBC_SIGSETJMP 1
 #endif
 #endif
@@ -897,9 +898,15 @@
    SYMFUNC(xf86shmctl)
 #ifdef HAS_GLIBC_SIGSETJMP
    SYMFUNC(xf86setjmp)
+   SYMFUNC(xf86setjmp0)
+#if defined(__GLIBC__) && (__GLIBC__ >= 2)
    SYMFUNCALIAS("xf86setjmp1",__sigsetjmp)
 #else
+   SYMFUNC(xf86setjmp1)		/* For libc5 */
+#endif
+#else
    SYMFUNCALIAS("xf86setjmp",setjmp)
+   SYMFUNCALIAS("xf86setjmp0",setjmp)
    SYMFUNC(xf86setjmp1)
 #endif
    SYMFUNCALIAS("xf86longjmp",longjmp)
Index: xc/programs/Xserver/hw/xfree86/os-support/xf86_ansic.h
diff -u xc/programs/Xserver/hw/xfree86/os-support/xf86_ansic.h:3.49 xc/programs/Xserver/hw/xfree86/os-support/xf86_ansic.h:3.49.2.1
--- xc/programs/Xserver/hw/xfree86/os-support/xf86_ansic.h:3.49	Sat Feb 22 01:00:39 2003
+++ xc/programs/Xserver/hw/xfree86/os-support/xf86_ansic.h	Wed Mar 12 23:10:49 2003
@@ -22,7 +22,7 @@
  *
  */
 
-/* $XFree86: xc/programs/Xserver/hw/xfree86/os-support/xf86_ansic.h,v 3.49 2003/02/22 06:00:39 dawes Exp $ */
+/* $XFree86: xc/programs/Xserver/hw/xfree86/os-support/xf86_ansic.h,v 3.49.2.1 2003/03/13 04:10:49 tsi Exp $ */
 
 #ifndef _XF86_ANSIC_H
 #define _XF86_ANSIC_H
@@ -307,13 +307,14 @@
 extern int xf86shmctl(int id, int xf86cmd, pointer buf);
 
 extern int xf86setjmp(xf86jmp_buf env);
+extern int xf86setjmp0(xf86jmp_buf env);
 extern int xf86setjmp1(xf86jmp_buf env, int);
 extern int xf86setjmp1_arg2(void);
 extern int xf86setjmperror(xf86jmp_buf env);
 extern int xf86getjmptype(void);
 extern void xf86longjmp(xf86jmp_buf env, int val);
 #define xf86setjmp_macro(env) \
-	(xf86getjmptype() == 0 ? xf86setjmp((env)) : \
+	(xf86getjmptype() == 0 ? xf86setjmp0((env)) : \
 	(xf86getjmptype() == 1 ? xf86setjmp1((env), xf86setjmp1_arg2()) : \
 		xf86setjmperror((env))))
 
Index: xc/programs/Xserver/hw/xfree86/os-support/bsd/alpha_video.c
diff -u xc/programs/Xserver/hw/xfree86/os-support/bsd/alpha_video.c:1.2 xc/programs/Xserver/hw/xfree86/os-support/bsd/alpha_video.c:1.2.2.1
--- xc/programs/Xserver/hw/xfree86/os-support/bsd/alpha_video.c:1.2	Tue Oct 29 18:19:13 2002
+++ xc/programs/Xserver/hw/xfree86/os-support/bsd/alpha_video.c	Thu May  8 22:30:43 2003
@@ -1,4 +1,4 @@
-/* $XFree86: xc/programs/Xserver/hw/xfree86/os-support/bsd/alpha_video.c,v 1.2 2002/10/29 23:19:13 herrb Exp $ */
+/* $XFree86: xc/programs/Xserver/hw/xfree86/os-support/bsd/alpha_video.c,v 1.2.2.1 2003/05/09 02:30:43 dawes Exp $ */
 /*
  * Copyright 1992 by Rich Murphey <Rich@Rice.edu>
  * Copyright 1993 by David Wexelblat <dwex@goblin.org>
@@ -33,9 +33,13 @@
 #include <sys/param.h>
 #ifndef __NetBSD__
 #  include <sys/sysctl.h>
+#  ifdef __FreeBSD__
+#      include <machine/sysarch.h>
+#   endif
 # else
 #  include <machine/sysarch.h>
 #endif
+
 #include "xf86Axp.h"
 
 #include "xf86_OSlib.h"
@@ -51,6 +55,8 @@
 #define MAP_FAILED ((caddr_t)-1)
 #endif
 
+axpDevice bsdGetAXP(void);
+
 #ifndef __NetBSD__
 extern unsigned long dense_base(void);
 
@@ -248,7 +254,6 @@
 #ifndef HAS_APERTURE_DRV
            xf86Msg(X_WARNING, "checkDevMem: failed to open/mmap %s (%s)\n",
                    DEV_MEM, strerror(errno));
-           xf86ErrorF("\tlinear framebuffer access unavailable\n");
 #else
 #ifndef __OpenBSD__
            xf86Msg(X_WARNING, "checkDevMem: failed to open %s and %s\n"
@@ -258,12 +263,11 @@
                    "\t(%s)\n%s", DEV_APERTURE, DEV_MEM, strerror(errno),
                    SYSCTL_MSG);
 #endif /* __OpenBSD__ */
-	   
+#endif
            xf86ErrorF("\tlinear framebuffer access unavailable\n");
 	}
 	useDevMem = FALSE;
 	return;
-#endif
 }
 
 void
@@ -486,6 +490,9 @@
 sethae(u_int64_t hae)
 {
 #ifdef __FreeBSD__
+#ifndef ALPHA_SETHAE
+#define ALPHA_SETHAE 0
+#endif
 	struct parms p;
 	p.hae = hae;
 	return (sysarch(ALPHA_SETHAE, (char *)&p));
Index: xc/programs/Xserver/hw/xfree86/os-support/bus/Pci.c
diff -u xc/programs/Xserver/hw/xfree86/os-support/bus/Pci.c:1.71 xc/programs/Xserver/hw/xfree86/os-support/bus/Pci.c:1.71.2.2
--- xc/programs/Xserver/hw/xfree86/os-support/bus/Pci.c:1.71	Thu Jan 23 11:22:13 2003
+++ xc/programs/Xserver/hw/xfree86/os-support/bus/Pci.c	Tue May  6 13:00:45 2003
@@ -1,4 +1,4 @@
-/* $XFree86: xc/programs/Xserver/hw/xfree86/os-support/bus/Pci.c,v 1.71 2003/01/23 16:22:13 tsi Exp $ */
+/* $XFree86: xc/programs/Xserver/hw/xfree86/os-support/bus/Pci.c,v 1.71.2.2 2003/05/06 17:00:45 tsi Exp $ */
 /*
  * Pci.c - New server PCI access functions
  *
@@ -573,7 +573,7 @@
 pciMfDev(int busnum, int devnum)
 {
     PCITAG tag0, tag1;
-    unsigned long id0, id1;
+    unsigned long id0, id1, val;
 
     /* Detect a multi-function device that complies to the PCI 2.0 spec */
 
@@ -582,7 +582,8 @@
     if (id0 == 0xffffffff)
 	return FALSE;
 
-    if (pciReadLong(tag0, PCI_HEADER_MISC) & PCI_HEADER_MULTIFUNCTION)
+    val = pciReadLong(tag0, PCI_HEADER_MISC) & 0x00ff0000;
+    if ((val != 0x00ff0000) && (val & PCI_HEADER_MULTIFUNCTION))
 	return TRUE;
 
     /*
@@ -969,6 +970,16 @@
 	for (i = 0; i < 17; i++)  /* PCI hdr plus 1st dev spec dword */
 	    devp->cfgspc.dwords[i] = pciReadLong(tag, i * sizeof(CARD32));
 
+#ifdef ARCH_PCI_HOST_BRIDGE
+	if ((devp->pci_base_class == PCI_CLASS_BRIDGE) &&
+	    (devp->pci_sub_class == PCI_SUBCLASS_BRIDGE_HOST))
+	    ARCH_PCI_HOST_BRIDGE(devp);
+#endif
+
+	/* Some broken devices don't implement this field... */
+	if (devp->pci_header_type == 0xff)
+	    devp->pci_header_type = 0;
+
 	switch (devp->pci_header_type & 0x7f) {
 	case 0:
 	    /* Get base address sizes for type 0 headers */
@@ -1025,9 +1036,6 @@
 		break;
 	    pciBusInfo[devp->busnum]->bridge = devp;
 	    pciBusInfo[devp->busnum]->primary_bus = devp->busnum;
-#ifdef ARCH_PCI_HOST_BRIDGE
-	    ARCH_PCI_HOST_BRIDGE(devp);
-#endif
 	    break;
 
 	case 1:
Index: xc/programs/Xserver/hw/xfree86/os-support/bus/Pci.h
diff -u xc/programs/Xserver/hw/xfree86/os-support/bus/Pci.h:1.36 xc/programs/Xserver/hw/xfree86/os-support/bus/Pci.h:1.36.2.1
--- xc/programs/Xserver/hw/xfree86/os-support/bus/Pci.h:1.36	Mon Dec 23 10:37:26 2002
+++ xc/programs/Xserver/hw/xfree86/os-support/bus/Pci.h	Fri Mar 21 17:29:59 2003
@@ -1,4 +1,4 @@
-/* $XFree86: xc/programs/Xserver/hw/xfree86/os-support/bus/Pci.h,v 1.36 2002/12/23 15:37:26 tsi Exp $ */
+/* $XFree86: xc/programs/Xserver/hw/xfree86/os-support/bus/Pci.h,v 1.36.2.1 2003/03/21 22:29:59 tsi Exp $ */
 /*
  * Copyright 1998 by Concurrent Computer Corporation
  *
@@ -96,8 +96,6 @@
 #else
 # define MAX_PCI_BUSES   256	/* Max number of PCI buses           */
 #endif
-
-#define PCI_NOT_FOUND   0xffffffff
 
 #define DEVID(vendor, device) \
     ((CARD32)((PCI_CHIP_##device << 16) | PCI_VENDOR_##vendor))
Index: xc/programs/Xserver/hw/xfree86/os-support/bus/xf86Pci.h
diff -u xc/programs/Xserver/hw/xfree86/os-support/bus/xf86Pci.h:1.36 xc/programs/Xserver/hw/xfree86/os-support/bus/xf86Pci.h:1.36.2.1
--- xc/programs/Xserver/hw/xfree86/os-support/bus/xf86Pci.h:1.36	Tue Feb 18 10:42:12 2003
+++ xc/programs/Xserver/hw/xfree86/os-support/bus/xf86Pci.h	Fri Mar 21 17:29:59 2003
@@ -1,4 +1,4 @@
-/* $XFree86: xc/programs/Xserver/hw/xfree86/os-support/bus/xf86Pci.h,v 1.36 2003/02/18 15:42:12 tsi Exp $ */
+/* $XFree86: xc/programs/Xserver/hw/xfree86/os-support/bus/xf86Pci.h,v 1.36.2.1 2003/03/21 22:29:59 tsi Exp $ */
 /*
  * Copyright 1998 by Concurrent Computer Corporation
  *
@@ -80,6 +80,8 @@
 #include "Xarch.h"
 #include "Xfuncproto.h"
 #include "misc.h"
+
+#define PCI_NOT_FOUND	0xFFFFFFFFU
 
 /*
  * PCI cfg space definitions (e.g. stuff right out of the PCI spec)
Index: xc/programs/Xserver/hw/xfree86/os-support/shared/libc_wrapper.c
diff -u xc/programs/Xserver/hw/xfree86/os-support/shared/libc_wrapper.c:1.88 xc/programs/Xserver/hw/xfree86/os-support/shared/libc_wrapper.c:1.88.2.2
--- xc/programs/Xserver/hw/xfree86/os-support/shared/libc_wrapper.c:1.88	Sat Feb 22 01:00:39 2003
+++ xc/programs/Xserver/hw/xfree86/os-support/shared/libc_wrapper.c	Thu Mar 13 16:49:53 2003
@@ -1,4 +1,4 @@
-/* $XFree86: xc/programs/Xserver/hw/xfree86/os-support/shared/libc_wrapper.c,v 1.88 2003/02/22 06:00:39 dawes Exp $ */
+/* $XFree86: xc/programs/Xserver/hw/xfree86/os-support/shared/libc_wrapper.c,v 1.88.2.2 2003/03/13 21:49:53 tsi Exp $ */
 /*
  * Copyright 1997 by The XFree86 Project, Inc.
  *
@@ -165,8 +165,9 @@
 #endif
 #include <setjmp.h>
 
-#if defined(setjmp) && \
-    defined(__GLIBC__) && __GLIBC__ == 2 && __GLIBC_MINOR__ < 2
+#if defined(setjmp) && defined(__GNU_LIBRARY__) && \
+    (!defined(__GLIBC__) || (__GLIBC__ < 2) || \
+     ((__GLIBC__ == 2) && (__GLIBC_MINOR__ < 3)))
 #define HAS_GLIBC_SIGSETJMP 1
 #endif
 
@@ -1961,23 +1962,48 @@
 }
 
 #ifdef HAS_GLIBC_SIGSETJMP
+
 int
 xf86setjmp(xf86jmp_buf env)
 {
+#if defined(__GLIBC__) && (__GLIBC__ >= 2)
+    return __sigsetjmp(env, xf86setjmp1_arg2());
+#else
+    return xf86setjmp1(env, xf86setjmp1_arg2());
+#endif
+}
+
+int
+xf86setjmp0(xf86jmp_buf env)
+{
     FatalError("setjmp: type 0 called instead of type %d\n", xf86getjmptype());
 }
-#else
+
+#if !defined(__GLIBC__) || (__GLIBC__ < 2)	/* libc5 */
+
 int
 xf86setjmp1(xf86jmp_buf env, int arg2)
 {
-    FatalError("setjmp: type 1 called instead of type %d\n", xf86getjmptype());
+    __sigjmp_save((void *)env, arg2);
+    return __setjmp((void *)env);
 }
+
 #endif
 
+#else	/* HAS_GLIBC_SIGSETJMP */
+
+int
+xf86setjmp1(xf86jmp_buf env, int arg2)
+{
+    FatalError("setjmp: type 1 called instead of type %d\n", xf86getjmptype());
+}
+
+#endif  /* HAS_GLIBC_SIGSETJMP */
+
 int
 xf86setjmp1_arg2()
 {
-    return 0;
+    return 1;
 }
 
 int
Index: xc/programs/Xserver/hw/xfree86/shadowfb/shadow.c
diff -u xc/programs/Xserver/hw/xfree86/shadowfb/shadow.c:1.18 xc/programs/Xserver/hw/xfree86/shadowfb/shadow.c:1.18.2.1
--- xc/programs/Xserver/hw/xfree86/shadowfb/shadow.c:1.18	Fri Feb 21 10:06:19 2003
+++ xc/programs/Xserver/hw/xfree86/shadowfb/shadow.c	Tue Apr 15 16:32:29 2003
@@ -6,7 +6,7 @@
    Pre-fb-write callbacks and RENDER support - Nolan Leake (nolan@vmware.com)
 */
 
-/* $XFree86: xc/programs/Xserver/hw/xfree86/shadowfb/shadow.c,v 1.18 2003/02/21 15:06:19 eich Exp $ */
+/* $XFree86: xc/programs/Xserver/hw/xfree86/shadowfb/shadow.c,v 1.18.2.1 2003/04/15 20:32:29 sven Exp $ */
 
 #include "X.h"
 #include "Xproto.h"
@@ -461,18 +461,28 @@
     ShadowScreenPtr pPriv = GET_SCREEN_PRIVATE(pScreen);
     PictureScreenPtr ps = GetPictureScreen(pScreen);
     BoxRec box;
+    BoxPtr extents;
     Bool boxNotEmpty = FALSE;
 
-    box.x1 = pDst->pDrawable->x + xDst;
-    box.y1 = pDst->pDrawable->y + yDst;
-    box.x2 = box.x1 + width;
-    box.y2 = box.y1 + height;
-
     if (pPriv->vtSema
-	&& pDst->pDrawable->type == DRAWABLE_WINDOW && BOX_NOT_EMPTY(box)) {
-        if (pPriv->preRefresh)
-            (*pPriv->preRefresh)(pPriv->pScrn, 1, &box);
-        boxNotEmpty = TRUE;
+	&& pDst->pDrawable->type == DRAWABLE_WINDOW) {
+
+	box.x1 = pDst->pDrawable->x + xDst;
+	box.y1 = pDst->pDrawable->y + yDst;
+	box.x2 = box.x1 + width;
+	box.y2 = box.y1 + height;
+
+	extents = &pDst->pCompositeClip->extents;
+	if(box.x1 < extents->x1) box.x1 = extents->x1;
+	if(box.x2 > extents->x2) box.x2 = extents->x2;
+	if(box.y1 < extents->y1) box.y1 = extents->y1;
+	if(box.y2 > extents->y2) box.y2 = extents->y2;
+	
+	if (BOX_NOT_EMPTY(box)) {
+	    if (pPriv->preRefresh)
+		(*pPriv->preRefresh)(pPriv->pScrn, 1, &box);
+	    boxNotEmpty = TRUE;
+	}
     }
     
     ps->Composite = pPriv->Composite;
Index: xc/programs/Xserver/hw/xfree86/xf86cfg/Imakefile
diff -u xc/programs/Xserver/hw/xfree86/xf86cfg/Imakefile:1.22 xc/programs/Xserver/hw/xfree86/xf86cfg/Imakefile:1.22.2.1
--- xc/programs/Xserver/hw/xfree86/xf86cfg/Imakefile:1.22	Wed Feb 26 15:08:03 2003
+++ xc/programs/Xserver/hw/xfree86/xf86cfg/Imakefile	Wed Mar 12 23:10:50 2003
@@ -1,4 +1,4 @@
-XCOMM $XFree86: xc/programs/Xserver/hw/xfree86/xf86cfg/Imakefile,v 1.22 2003/02/26 20:08:03 dawes Exp $
+XCOMM $XFree86: xc/programs/Xserver/hw/xfree86/xf86cfg/Imakefile,v 1.22.2.1 2003/03/13 04:10:50 tsi Exp $
 
 XCOMM CDEBUGFLAGS=-g -Wall -ansi -pedantic
 
@@ -96,15 +96,11 @@
 CURSESDEFINES  = -DHAS_NCURSES
 #endif
 
-#if HasGlibc21Sigsetjmp
-SETJMPDEFINES = -DHAS_GLIBC_SIGSETJMP=1
-#endif
-
 XF86CONFIGFILE = XConfigFile
 XF86CONFIGDIR = XConfigDir
 
 DEFINES        = -DXF86CONFIG=\"$(XF86CONFIGFILE)\" $(MODULEDEFINES) \
-		 $(CURSESDEFINES) $(SETJMPDEFINES) \
+		 $(CURSESDEFINES) \
 		 -DPROJECT_ROOT=\"$(PROJECTROOT)\" \
 		 -DXF86CONFIGDIR=\"$(XF86CONFIGDIR)\" XFree86ConsoleDefines
 
Index: xc/programs/Xserver/hw/xfree86/xf86cfg/loadmod.c
diff -u xc/programs/Xserver/hw/xfree86/xf86cfg/loadmod.c:1.14 xc/programs/Xserver/hw/xfree86/xf86cfg/loadmod.c:1.14.2.1
--- xc/programs/Xserver/hw/xfree86/xf86cfg/loadmod.c:1.14	Wed Feb 26 15:08:03 2003
+++ xc/programs/Xserver/hw/xfree86/xf86cfg/loadmod.c	Wed Mar 12 23:10:50 2003
@@ -26,15 +26,16 @@
  *
  * Author: Paulo Csar Pereira de Andrade <pcpa@conectiva.com.br>
  *
- * $XFree86: xc/programs/Xserver/hw/xfree86/xf86cfg/loadmod.c,v 1.14 2003/02/26 20:08:03 dawes Exp $
+ * $XFree86: xc/programs/Xserver/hw/xfree86/xf86cfg/loadmod.c,v 1.14.2.1 2003/03/13 04:10:50 tsi Exp $
  */
 
 #ifdef USE_MODULES
 #include <setjmp.h>
 
 #ifndef HAS_GLIBC_SIGSETJMP
-#if defined(setjmp) && \
-    defined(__GLIBC__) && __GLIBC__ == 2 && __GLIBC_MINOR__ < 2
+#if defined(setjmp) && defined(__GNU_LIBRARY__) && \
+    (!defined(__GLIBC__) || (__GLIBC__ < 2) || \
+     ((__GLIBC__ == 2) && (__GLIBC_MINOR__ < 3)))
 #define HAS_GLIBC_SIGSETJMP 1
 #endif
 #endif
@@ -275,9 +276,15 @@
    SYMFUNC(xf86shmctl)
 #ifdef HAS_GLIBC_SIGSETJMP
    SYMFUNC(xf86setjmp)
+   SYMFUNC(xf86setjmp0)
+#if defined(__GLIBC__) && (__GLIBC__ >= 2)
    SYMFUNCALIAS("xf86setjmp1",__sigsetjmp)
 #else
+   SYMFUNC(xf86setjmp1)
+#endif
+#else
    SYMFUNCALIAS("xf86setjmp",setjmp)
+   SYMFUNCALIAS("xf86setjmp0",setjmp)
    SYMFUNC(xf86setjmp1)
 #endif
    SYMFUNCALIAS("xf86longjmp",longjmp)
Index: xc/programs/Xserver/include/Imakefile
diff -u xc/programs/Xserver/include/Imakefile:3.21 xc/programs/Xserver/include/Imakefile:3.21.8.2
--- xc/programs/Xserver/include/Imakefile:3.21	Wed Jan 17 17:36:56 2001
+++ xc/programs/Xserver/include/Imakefile	Mon Mar  3 21:46:18 2003
@@ -3,7 +3,7 @@
 
 
 
-XCOMM $XFree86: xc/programs/Xserver/include/Imakefile,v 3.21 2001/01/17 22:36:56 dawes Exp $
+XCOMM $XFree86: xc/programs/Xserver/include/Imakefile,v 3.21.8.2 2003/03/04 02:46:18 torrey Exp $
 
 #if defined(XFree86Version) || defined(BSDOSArchitecture)
 #if DoLoadableServer
Index: xc/programs/Xserver/xkb/xkbInit.c
diff -u xc/programs/Xserver/xkb/xkbInit.c:3.26 xc/programs/Xserver/xkb/xkbInit.c:3.26.2.1
--- xc/programs/Xserver/xkb/xkbInit.c:3.26	Sun Feb  9 01:29:20 2003
+++ xc/programs/Xserver/xkb/xkbInit.c	Mon Mar 17 18:53:14 2003
@@ -24,7 +24,7 @@
 THE USE OR PERFORMANCE OF THIS SOFTWARE.
 
 ********************************************************/
-/* $XFree86: xc/programs/Xserver/xkb/xkbInit.c,v 3.26 2003/02/09 06:29:20 paulo Exp $ */
+/* $XFree86: xc/programs/Xserver/xkb/xkbInit.c,v 3.26.2.1 2003/03/17 23:53:14 paulo Exp $ */
 
 #include <stdio.h>
 #include <stdlib.h>
@@ -713,7 +713,7 @@
     if (names->types) names->types = _XkbDupString(names->types);
     if (names->compat) names->compat = _XkbDupString(names->compat);
     if (names->geometry) names->geometry = _XkbDupString(names->geometry);
-    if (names->symbols) names->geometry = _XkbDupString(names->symbols);
+    if (names->symbols) names->symbols = _XkbDupString(names->symbols);
 
     if (defs.model && defs.layout && rules) {
 	XkbComponentNamesRec	rNames;
